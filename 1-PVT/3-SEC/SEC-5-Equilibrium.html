
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Определение равновесного состояния системы &#8212; Основы моделирования пластовых систем</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=5194fb77" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '1-PVT/3-SEC/SEC-5-Equilibrium';</script>
    <script src="../../_static/custom.js?v=4c678b35"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Определение насыщенного состояния системы" href="SEC-6-Saturation.html" />
    <link rel="prev" title="Уравнение Речфорда-Райса для многофазных систем" href="SEC-4-RR-NP.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../Introduction.html">
  
  
  
  
  
  
    <p class="title logo__title">Основы моделирования пластовых систем</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../Introduction.html">
                    Основы моделирования пластовых систем
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Основы вычислительной математики</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../0-Math/Math-Introduction.html">Введение</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../0-Math/0-LAB/LAB-0-Introduction.html">Основы линейной алгебры</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-1-Vectors.html">Вектор. Координаты вектора</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-2-VectorOperations.html">Операции с векторами</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-3-RotationAngles.html">Направляющие косинусы</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-4-Matrices.html">Матрицы</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-5-Determinant-InverseMatrix.html">Определитель матрицы. Обратная матрица</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-6-Eigenvalues-Eigenvectors.html">Собственные векторы и значения матриц</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-7-LinearTransformations.html">Линейные преобразования</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-8-MatrixDefiniteness.html">Определенность матриц</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-9-Decomposition.html">Разложение матриц</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-10-LinearSystems.html">Решение систем линейных уравнений</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-11-ConditionNumber.html">Число обусловленности</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0-Math/0-LAB/LAB-12-Preconditioner.html">Предобуславливание</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../0-Math/1-OM/OM-0-Introduction.html">Методы оптимизации функций</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">PVT-моделирование</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../PVT-Introduction.html">Введение</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../1-TD/TD-0-Introduction.html">Основы термодинамики</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-1-Basics.html">Введение в термодинамику</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-2-ThermalEquilibrium.html">Термическое равновесие. Температура. Нулевое начало термодинамики</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-3-Heat-Work.html">Количество теплоты и работа. Первое начало термодинамики</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-4-HeatCapacity.html">Теплоемкость</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-5-Enthalpy.html">Энтальпия</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-6-Entropy.html">Энтропия. Второе и третье начала термодинамики</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-7-ChemicalPotential.html">Химический потенциал</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-8-Helmholtz-Gibbs.html">Энергия Гельмгольца. Энергия Гиббса</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-9-Observables.html">Интенсивные и экстенсивные параметры</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-10-MixtureGibbsEnergy.html">Энергия Гиббса многокомпонентной системы</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-11-GibbsPhaseRule.html">Правило фаз Гиббса</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-12-GibbsDuhemEquation.html">Уравнение Гиббса-Дюгема</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-13-MaxwellRelations.html">Соотношения Максвелла</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-14-PhaseEquilibrium.html">Свободная энергия и фазовое равновесие</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-TD/TD-15-Fugacity.html">Летучесть</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2-EOS/EOS-0-Introduction.html">Уравнения состояния</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../2-EOS/EOS-1-VanDerWaals.html">Уравнение состояния Ван-дер-Ваальса</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-EOS/EOS-2-SRK-PR.html">Уравнения состояния Суаве-Редлиха-Квонга и Пенга-Робинсона</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-EOS/EOS-3-CPA.html">Кубическое уравнение состояние с учетом ассоциации молекул</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-EOS/EOS-Appendix-A-PD.html">Частные производные летучести компонентов</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-EOS/EOS-Appendix-B-BIP.html">Универсальный расчет коэффициентов попарного взаимодействия</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-EOS/EOS-Appendix-C-HV.html">Правило смешивания Хьюрона-Видаля</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="SEC-0-Introduction.html">Стабильность. Равновесие. Критическое состояние</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="SEC-1-Stability.html">Определение стабильности фазового состояния системы</a></li>
<li class="toctree-l2"><a class="reference internal" href="SEC-2-RR.html">Уравнение Речфорда-Райса</a></li>
<li class="toctree-l2"><a class="reference internal" href="SEC-3-RR-2P.html">Уравнение Речфорда-Райса для двухфазных систем</a></li>
<li class="toctree-l2"><a class="reference internal" href="SEC-4-RR-NP.html">Уравнение Речфорда-Райса для многофазных систем</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Определение равновесного состояния системы</a></li>
<li class="toctree-l2"><a class="reference internal" href="SEC-6-Saturation.html">Определение насыщенного состояния системы</a></li>
<li class="toctree-l2"><a class="reference internal" href="SEC-7-Criticality.html">Определение критического состояния системы</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../4-LAB/LAB-0-Introduction.html">Моделирование лабораторных исследований</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-ETC/ETC-0-Introduction.html">Применение PVT-моделирования для решения практических задач проектирования месторождений углеводородов</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/1-PVT/3-SEC/SEC-5-Equilibrium.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Определение равновесного состояния системы</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pt">PT-термодинамика</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-ss">Метод последовательных подстановок</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-ss-init">Начальные приближения</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-ss-examples">Примеры</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-newton">Метод минимизации функции</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-newton-init">Начальные приближения</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-newton-examples">Примеры</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#vt">VT-термодинамика</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="pvt-esc-equilibrium">
<span id="id1"></span><h1>Определение равновесного состояния системы<a class="headerlink" href="#pvt-esc-equilibrium" title="Link to this heading">#</a></h1>
<p>В предыдущих разделах данной главы были представлены особенности проверки <a class="reference internal" href="SEC-1-Stability.html"><span class="std std-doc">стабильности фазового состояния системы</span></a>, а также получено <a class="reference internal" href="SEC-2-RR.html"><span class="std std-doc">уравнение Речфорда-Райса</span></a> и рассмотрены численные методы его решения для <a class="reference internal" href="SEC-3-RR-2P.html"><span class="std std-doc">двухфазной</span></a> и <a class="reference internal" href="SEC-4-RR-NP.html"><span class="std std-doc">многофазной</span></a> систем. Данный раздел посвящен расчету равновесного фазового состояния для различных формулировок: <a class="reference internal" href="#pvt-esc-equilibrium-pt">PT-термодинамика</a>, <a class="reference internal" href="#pvt-esc-equilibrium-vt">VT-термодинамика</a>.</p>
<section id="pt">
<span id="pvt-esc-equilibrium-pt"></span><h2>PT-термодинамика<a class="headerlink" href="#pt" title="Link to this heading">#</a></h2>
<p>В результате решения задачи поиска равновесного состояния многокомпонентной (<span class="math notranslate nohighlight">\(N_c\)</span> – количество компонентов), многофазной (<span class="math notranslate nohighlight">\(N_p\)</span> – количество фаз) системы для фиксированных и известных давления <span class="math notranslate nohighlight">\(P\)</span>, температуры <span class="math notranslate nohighlight">\(T\)</span>, а также количеств вещества компонентов в системе <span class="math notranslate nohighlight">\(n_i, \, i = 1 \, \ldots \, N_c,\)</span> требуется определить количества вещества компонентов в фазах <span class="math notranslate nohighlight">\(n_{ji}, \, j = 1 \, \ldots N_p - 1, \, i = 1 \, \ldots \, N_c,\)</span> то есть всего <span class="math notranslate nohighlight">\(N_c \times \left( N_p - 1 \right)\)</span> неизвестных, соответствующих положению <a class="reference internal" href="../1-TD/TD-14-PhaseEquilibrium.html"><span class="std std-doc">глобального минимума функции энергии Гиббса</span></a>, с учетом ограничений <span class="math notranslate nohighlight">\(0 \leq n_{ji} \leq n_i, \, j = 1 \, \ldots N_p, \, i = 1 \, \ldots \, N_c,\)</span> и <span class="math notranslate nohighlight">\(\sum_{j=1}^{N_p} n_{ji} = n_i, \, i = 1 \, \ldots \, N_c,\)</span>. В этом случае задача поиска равновесного состояния формулируется как задача минимизации функции энергии Гиббса и, принимая во внимание ее <a class="reference internal" href="../1-TD/TD-9-Observables.html#pvt-td-observables-extensive"><span class="std std-ref">экстенсивность</span></a>, может быть записана следующим образом:</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="note admonition">
<p class="admonition-title">Дополнительно</p>
<p>При использовании двойного индексирования здесь и далее первый индекс будет обозначать фазу, второй – компонент. То есть под <span class="math notranslate nohighlight">\(n_{ji}\)</span> следует понимать количество вещества <span class="math notranslate nohighlight">\(i\)</span>-го компонента в <span class="math notranslate nohighlight">\(j\)</span>-й фазе, а под, например, <span class="math notranslate nohighlight">\(f_{N_pk}\)</span> – летучесть <span class="math notranslate nohighlight">\(k\)</span>-го компонента в <span class="math notranslate nohighlight">\(N_p\)</span>-й фазе. При использовании одинарного индексирования будет явно указано отношение данного элемента к вектору, характеризующему свойства фаз или компонентов.</p>
</div>
</aside>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{alignat}{1}
\min_{\hat{K}} &amp; \;\;\;\;\;\;\; &amp;&amp; G \left( \hat{K} \right) = \sum_{j=1}^{N_p} G_j \left( \mathbf{n}_j \right) \\
\mathrm{subject\,to} &amp;&amp;&amp; 0 \leq n_{ji} \leq n_i, \; j = 1 \, \ldots \, N_p, \; i = 1 \, \ldots \, N_c \\
&amp;&amp;&amp; \sum_{j=1}^{N_p} n_{ji} = n_i, \; i = 1 \, \ldots \, N_c
\end{alignat} \end{split}\]</div>
<p>В представленном выше выражении используется система нестрогих неравенств: <span class="math notranslate nohighlight">\(0 \leq n_{ji} \leq n_i, \, j = 1 \, \ldots \, N_p, \, i = 1 \, \ldots \, N_c,\)</span> позволяющая методам глобальной оптимизации убирать из системы фазы, задавая количествам вещества компонентов в них нулевые значения. Несмотря на возможность применения методов глобальной оптимизации для решения задачи определения равновесного состояния системы [<a class="reference external" href="https://doi.org/10.2118/37689-PA">Pan and Firoozabadi, 1992</a>; <a class="reference external" href="https://doi.org/10.1016/S0098-1354(02)00144-8">Nichita et al, 2002</a>] их целесообразность для задач гидродинамического моделирования остается сомнительной из-за высокой сложности алгоритма. В связи с этим на практике зачастую применяюся методы локальной минимизации для фиксированного количества фаз <span class="math notranslate nohighlight">\(N_p\)</span>. Причем, поскольку количество фаз <span class="math notranslate nohighlight">\(N_p\)</span> заранее неизвестно, то определение равновесного состояния сводится к циклу, состоящему из следующих последовательных действий:</p>
<ol class="arabic simple">
<li><p>Делается предположение <span class="math notranslate nohighlight">\(N_p\)</span>-фазового состояния. Проводится расчет распределения количеств вещества компонентов для <span class="math notranslate nohighlight">\(N_p\)</span>-фазового состояния.</p></li>
<li><p>Выполняется проверка стабильности <span class="math notranslate nohighlight">\(N_p\)</span>-фазового состояния.</p></li>
<li><p>Если <span class="math notranslate nohighlight">\(N_p\)</span>-фазовое состояние оказалось стабильным, то оно является равновесным. Иначе количество фаз увеличивается на единицу, и цикл повторяется.</p></li>
</ol>
<p>При отсутствии исходных данных о количестве фаз в системе данный алгоритм начинается с предположения о нахождении системы в однофазном состоянии. Заканчивается данный цикл, пока не будет определено равновесное состояние, или пока не будет достигнуто максимальное количество фаз в системе.</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/First_derivative_test">Известно</a>, что необходимым условием для соответствия некоторой точки (состояния) глобальному минимуму функции (энергии Гиббса) является равенство нулю производной этой функции по независимым переменным в этой точке (этом состоянии). <a class="reference internal" href="SEC-1-Stability.html"><span class="std std-doc">Ранее</span></a> было показано, что состояние, в котором частные производные энергии Гиббса всей системы по количеству вещества <span class="math notranslate nohighlight">\(i\)</span>-го компонента в <span class="math notranslate nohighlight">\(j\)</span>-ой фазе для всех <span class="math notranslate nohighlight">\(i = 1 \, \ldots \, N_c\)</span> и <span class="math notranslate nohighlight">\(j = 1 \, \ldots \, N_p - 1\)</span> при фиксированных давлении и температуре равняются нулю, называется <em>стационарным</em> и характеризуется равенством химических потенциалов соответствующих компонентов в фазах:</p>
<div class="math notranslate nohighlight">
\[ \mu_{ji} - \mu_{N_pi} = 0, \; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c. \]</div>
<p>Принимая во внимание <a class="reference internal" href="../1-TD/TD-15-Fugacity.html"><span class="std std-doc">соотношение</span></a> между летучестью и химическим потенциалом компонентов при фиксированных и известных давлении и температуре всей системы, система уравнений, определяющая положение стационарных точек функции энергии Гиббса (локальных минимумов), может быть записана с использованием летучестей компонентов:</p>
<div class="math notranslate nohighlight">
\[ f_{ji} - f_{N_pi} = 0, \; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c. \]</div>
<p>При использовании <em>констант фазового равновесия</em>, введенных при рассмотрении <a class="reference internal" href="SEC-2-RR.html"><span class="std std-doc">уравнения Речфорда-Райса</span></a>, и коэффициентов летучести компонентов данная система уравнений записывается следующим образом:</p>
<div class="math notranslate nohighlight">
\[ g_{ji} = \ln K_{ji} + \ln \varphi_{ji} - \ln \varphi_{N_pi} = 0, \; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c. \]</div>
<section id="pvt-sec-equilibrium-pt-ss">
<span id="id2"></span><h3>Метод последовательных подстановок<a class="headerlink" href="#pvt-sec-equilibrium-pt-ss" title="Link to this heading">#</a></h3>
<p>Одним из наиболее распространенных подходов к решению системы нелинейных уравнений, определяющей положение стационарных точек функии энергии Гиббса, является <em>метод последовательных подстановок (successive substitution method)</em>, также называемый <a class="reference external" href="https://en.wikipedia.org/wiki/Fixed-point_iteration">методом простой итерации</a>, суть которого заключается в итерационном обновлении основных переменных с использованием следующего выражения:</p>
<div class="math notranslate nohighlight">
\[ \mathbf{t}^{k+1} = f \left( \mathbf{t}^{k} \right), \]</div>
<p>где <span class="math notranslate nohighlight">\(\mathbf{t}^{k+1} \in {\rm I\!R}^n\)</span> – вектор основных переменных на <span class="math notranslate nohighlight">\(\left( k+1 \right)\)</span>-й итерации, <span class="math notranslate nohighlight">\(\mathbf{t}^{k} \in {\rm I\!R}^n\)</span> – вектор основных переменных на <span class="math notranslate nohighlight">\(\left( k \right)\)</span>-й итерации, <span class="math notranslate nohighlight">\(f \, : \, {\rm I\!R}^n \rightarrow {\rm I\!R}^n\)</span> – функция, принимающая на вход вектор размерности <span class="math notranslate nohighlight">\(n\)</span> и возвращающая вектор такой же размерности. Соответственно, такая система уравнений должна иметь решение, удовлетворяющее следующему соотношению:</p>
<div class="math notranslate nohighlight">
\[ \mathbf{t}^{*} = f \left( \mathbf{t}^{*} \right), \]</div>
<p>где <span class="math notranslate nohighlight">\(\mathbf{t}^{*} \in {\rm I\!R}^n\)</span> – вектор основных переменных, соответствующий решению системы нелинейных уравнений.</p>
<p>Применительно к рассматриваеммой задаче обновление основных переменных (логарифмов констант фазового равновесия) может быть осуществлено в методе последовательных подстановок с использованием следующего выражения:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
\ln K_{ji}^{k+1} &amp;= \ln \varphi_{N_pi}^k - \ln \varphi_{ji}^k, \; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c, \\
\ln K_{ji}^{k+1} &amp;= \ln K_{ji}^{k} - g_{ji}^k, \; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c,
\end{align} \end{split}\]</div>
<p>где <span class="math notranslate nohighlight">\(k\)</span> – номер итерации.</p>
<p>Важно отметить, что при использовании констант фазового равновесия в качестве основных переменных для решения системы нелинейных уравнений, определяющей положение локальных минимумов функции энергии Гиббса, методом последовательных подстановок необходимо на каждой итерации внешнего цикла (обновления констант фазового равновесия) решать <a class="reference internal" href="SEC-2-RR.html"><span class="std std-doc">уравнение Речфорда-Райса</span></a> во внутреннем цикле для определения мольных долей фаз и их компонентных составов.</p>
<p>Рассмотрим алгоритм метода последовательных подстановок.</p>
<div class="algorithm admonition">
<p class="admonition-title">Алгоритм. Метод последовательных подстановок для определения равновесного состояния</p>
<p><strong>Дано:</strong> Вектор компонентного состава исследуемой системы <span class="math notranslate nohighlight">\(\mathbf{z} \in {\rm I\!R}^{N_c}\)</span>; термобарические условия <span class="math notranslate nohighlight">\(P\)</span> и <span class="math notranslate nohighlight">\(T\)</span>; количество вещества в системе <span class="math notranslate nohighlight">\(n=1 \, моль\)</span>; необходимые свойства компонентов для нахождения коэффициентов летучести компонентов с использованием уравнения состояния; количество фаз в системе <span class="math notranslate nohighlight">\(N_p\)</span>; набор (тензор) начальных приближений констант фазового равновесия <span class="math notranslate nohighlight">\(\mathbf{K}_0 \in {\rm I\!R}^{N \times \left( N_p - 1 \right) \times N_c}\)</span>; максимальное число итераций <span class="math notranslate nohighlight">\(N_{iter}\)</span>; точность <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p>
<p><strong>Определить:</strong> Компонентные составы фаз <span class="math notranslate nohighlight">\(\mathbf{Y} \in {\rm I\!R}^{ \left( N_p - 1 \right) \times N_c}\)</span> и мольные доли фаз <span class="math notranslate nohighlight">\(\mathbf{F} \in {\rm I\!R}^{N_p-1}\)</span> в системе, соответствующие равновесному состоянию.</p>
<p><strong>Псевдокод:</strong><br />
<strong>def</strong> <span class="math notranslate nohighlight">\(\phi \left( \mathbf{Y} \in {\rm I\!R}^{\left( N_p - 1 \right) \times N_c}, \, \ldots \right) \rightarrow \mathbf{\Phi} \in {\rm I\!R}^{\left( N_p - 1 \right) \times N_c}\)</span> <span class="comment"># Функция для расчета матрицы коэф-тов летучести</span><br />
<strong>def</strong> <span class="math notranslate nohighlight">\(R \left( \mathbf{K} \in {\rm I\!R}^{\left( N_p - 1 \right) \times N_c}, \, \mathbf{z} \right) \rightarrow \mathbf{F} \in {\rm I\!R}^{N_p-1}\)</span> <span class="comment"># Функция для решения уравнения Речфорда-Райса</span><br />
<strong>for</strong> <span class="math notranslate nohighlight">\(i := 1\)</span> <strong>to</strong> <span class="math notranslate nohighlight">\(N\)</span> <strong>do</strong> <span class="comment"># Цикл перебора начальных приближений</span><br />
 <span class="math notranslate nohighlight">\(\mathbf{K} := \mathbf{K}_0 \left[ i,:,: \right]\)</span> <span class="comment"># Матрица начальных приближений констант фазового равновесия</span><br />
 <span class="math notranslate nohighlight">\(\mathbf{F} := R \left( \mathbf{K}, \, \mathbf{z} \right)\)</span> <span class="comment"># Вектор мольных долей фаз для начального приближения</span><br />
 <span class="math notranslate nohighlight">\(\mathbf{x} := \mathbf{z} \, / \left( \mathbf{F}^\top \left(\mathbf{K} - 1 \right) + 1 \right)\)</span> <span class="comment"># Компонентный состав референсной фазы</span><br />
 <span class="math notranslate nohighlight">\(\mathbf{Y} := \mathbf{K} \cdot \mathbf{x}\)</span> <span class="comment"># Матрица компонентных составов нереференсных фаз</span><br />
 <span class="math notranslate nohighlight">\(\mathbf{\Phi} := \phi \left( \mathbf{Y} \right)\)</span> <span class="comment"># Матрица коэффициентов летучести компонентов в нереференсных фазах</span><br />
 <span class="math notranslate nohighlight">\(\boldsymbol{\varphi} := \phi \left( \mathbf{x} \right)\)</span> <span class="comment"># Вектор коэффициентов летучести компонентов в референсной фазе</span><br />
 <span class="math notranslate nohighlight">\(\mathbf{g} := \ln \mathbf{K} + \ln \mathbf{\Phi} - \ln \boldsymbol{\varphi}\)</span> <span class="comment"># Матрица невязок</span><br />
 <span class="math notranslate nohighlight">\(k := 1\)</span> <span class="comment"># Счетчик итераций</span><br />
 <strong>while</strong> <span class="math notranslate nohighlight">\(\lVert \mathbf{g} \rVert_2 &gt; \epsilon\)</span> <strong>and</strong> <span class="math notranslate nohighlight">\(k &lt; N_{iter}\)</span> <strong>do</strong> <span class="comment"># Цикл решения системы нелинейных уравнений</span><br />
  <span class="math notranslate nohighlight">\(\mathbf{K} := \mathbf{K} \cdot \exp \left( - \mathbf{g} \right)\)</span>  <span class="comment"># Обновление матрицы основных переменных</span><br />
  <span class="math notranslate nohighlight">\(\mathbf{F} := R \left( \mathbf{K}, \, \mathbf{z} \right)\)</span> <span class="comment"># Вектор мольных долей фаз</span><br />
  <span class="math notranslate nohighlight">\(\mathbf{x} := \mathbf{z} \, / \left( \mathbf{F}^\top \left(\mathbf{K} - 1 \right) + 1 \right)\)</span> <span class="comment"># Компонентный состав референсной фазы</span><br />
  <span class="math notranslate nohighlight">\(\mathbf{Y} := \mathbf{K} \cdot \mathbf{x}\)</span> <span class="comment"># Матрица компонентных составов нереференсных фаз</span><br />
  <span class="math notranslate nohighlight">\(\mathbf{\Phi} := \phi \left( \mathbf{Y} \right)\)</span> <span class="comment"># Матрица коэффициентов летучести компонентов в нереференсных фазах</span><br />
  <span class="math notranslate nohighlight">\(\boldsymbol{\varphi} := \phi \left( \mathbf{x} \right)\)</span> <span class="comment"># Вектор коэффициентов летучести компонентов в референсной фазе</span><br />
  <span class="math notranslate nohighlight">\(\mathbf{g} := \ln \mathbf{K} + \ln \mathbf{\Phi} - \ln \boldsymbol{\varphi}\)</span> <span class="comment"># Матрица невязок</span><br />
  <span class="math notranslate nohighlight">\(k := k + 1\)</span> <span class="comment"># Обновление счетчика итераций</span><br />
 <strong>end while</strong><br />
 <strong>if</strong> <span class="math notranslate nohighlight">\(\lVert \mathbf{g} \rVert_2 &lt; \epsilon\)</span> <strong>then</strong><br />
  <strong>exit for</strong><br />
 <strong>end if</strong><br />
<strong>end for</strong></p>
</div>
<section id="pvt-sec-equilibrium-pt-ss-init">
<span id="id3"></span><h4>Начальные приближения<a class="headerlink" href="#pvt-sec-equilibrium-pt-ss-init" title="Link to this heading">#</a></h4>
<p>В качестве начального приближения для алгоритма метода последовательных подстановок при определении двухфазного равновесного состояния можно использовать результаты анализа стабильности, одним из которых является вектор <span class="math notranslate nohighlight">\(Y_i, \, i = 1 \, \ldots \, N_c,\)</span> соответствующий наименьшему стационарному значению функции <span class="math notranslate nohighlight">\(TPD\)</span> и интерепретируемый как вектор количеств вещества компонентов в мнимой фазе, находящейся в термодинамическом равновесии с известным компонентным составом проверяемой на стабильность системы. Тогда вектор</p>
<div class="math notranslate nohighlight">
\[ y_i = \frac{Y_i}{\sum_{j=1}^{N_c} Y_j}, \; i = 1 \, \ldots \, N_c, \]</div>
<p>представляет собой вектор мольных долей компонентов в мнимой фазе. Следовательно, набор начальных приближений для расчета равновесного состояния может быть записан следующим образом [<a class="reference external" href="https://doi.org/10.2118/87335-PA">Pan and Firoozabadi, 2003</a>]:</p>
<div class="math notranslate nohighlight">
\[ \mathbf{K}_0 = \left\{ y_i \, / \, z_i, \; z_i  \, / \, y_i, \; i = 1 \, \ldots \, N_c \right\}. \]</div>
<p>Использование такого набора начальных приближений для расчета двухфазного равновесного состояния отлично подходит для состояний систем, находящихся вблизи границы двуфазной области, однако для случаев, когда состояние далеко от границы двухфазной области, рекомендуется использовать набор начальных приближений, что и для <a class="reference internal" href="SEC-1-Stability.html#pvt-sec-stability-pt-ss-init"><span class="std std-ref">проверки стабильности системы</span></a> [<a class="reference external" href="https://doi.org/10.2118/87335-PA">Pan and Firoozabadi, 2003</a>; <a class="reference external" href="https://doi.org/10.1016/j.fluid.2010.11.007">Nichita and Graciaa, 2011</a>]. В качестве критерия, определяющего, находится ли система вблизи границы двухфазной области, можно использовать значение <a class="reference internal" href="SEC-1-Stability.html"><span class="std std-doc">функции TPD</span></a>. То есть если <span class="math notranslate nohighlight">\(TPD &gt; -c_1\)</span>, то начальное приближение лучше генерировать на основе результатов анализа стабильности, в противном случае – на основе эмпирических корреляций. Значения параметра <span class="math notranslate nohighlight">\(c_1\)</span> авторами работы [<a class="reference external" href="https://doi.org/10.2118/87335-PA">Pan and Firoozabadi, 2003</a>] рекомендуется выбирать из диапазона <span class="math notranslate nohighlight">\(\left[ 10^{-4}, \, 10^{-3} \right]\)</span>.</p>
<p>Подход к определению начальных приближений для многофазного расчета равновесного состояния был предложен авторами работы [<a class="reference external" href="https://doi.org/10.1016/j.fluid.2012.06.021">Li and Firoozabadi, 2012</a>]. Результатом двухфазного расчета равновесного состояния является некоторое состояние системы, характеризующееся равенством летучестей соответствующих компонентов, компонентными составами фаз <span class="math notranslate nohighlight">\(y_{1i}, \, i = 1 \, \ldots \, N_c,\)</span> и <span class="math notranslate nohighlight">\(y_{2i}, \, i = 1 \, \ldots \, N_c,\)</span>, мольными долями фаз <span class="math notranslate nohighlight">\(F_1\)</span> и <span class="math notranslate nohighlight">\(F_2\)</span>, а также константами фазого равновесия <span class="math notranslate nohighlight">\(K_{1i} = y_{1i} \, / \, y_{2i}, \, i = 1 \, \ldots \, N_c\)</span>. Затем, согласно представленному выше алгоритму, должен быть проведен тест стабильности компонентного состава одной из фаз, например, <span class="math notranslate nohighlight">\(y_{2i}, \, i = 1 \, \ldots \, N_c,\)</span>. В случае нестабильности двухфазного состояния системы результатом теста является некоторая мнимая фаза <em>(trial phase)</em> с компонентным составом <span class="math notranslate nohighlight">\(x_i, \, i = 1 \, \ldots \, N_c,\)</span> и константами фазового равновесия <span class="math notranslate nohighlight">\(K_{ti} = x_i \, / \, y_{2i}, \, i = 1 \, \ldots \, N_c,\)</span> находящаяся в термодинамическом равновесии с компонентным составом тестируемой фазы. Таким образом, набор констант фазового равновесия <span class="math notranslate nohighlight">\(\mathbf{K} = \left\{ K_{1i}, \, K_{ti} \right\}\)</span> является хорошим начальным приближением для расчета трехфазного равновесного состояния. При этом начальное приближение необходимо и для <a class="reference internal" href="SEC-4-RR-NP.html"><span class="std std-doc">алгоритма</span></a> решения системы уравнений Речфорда-Райса, в качестве которого может выступить вектор <span class="math notranslate nohighlight">\(\mathbf{F} = \left( F_1, \, 0 \right)^\top\)</span>, поскольку мнимая фаза характеризуется пренебрежимо малой мольной долей.</p>
</section>
<section id="pvt-sec-equilibrium-pt-ss-examples">
<span id="id4"></span><h4>Примеры<a class="headerlink" href="#pvt-sec-equilibrium-pt-ss-examples" title="Link to this heading">#</a></h4>
<p>Рассмотрим применение метода последовательных подстановок для решения системы нелинейных уравнений, определяющей положение локальных минимумов функции энергии Гиббса.</p>
<div class="exercise admonition">
<p class="admonition-title">Пример</p>
<p>Пусть имеется <span class="math notranslate nohighlight">\(1 \; моль\)</span> смеси из метана и диоксида углерода при температуре <span class="math notranslate nohighlight">\(10 \; ^{\circ} C\)</span> и давлении <span class="math notranslate nohighlight">\(6 \; МПа\)</span> с мольной долей метана <span class="math notranslate nohighlight">\(0.1\)</span>. Необходимо определить равновесное состояние системы.</p>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Решение</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Для решения данной и последующих задач будем использовать <a class="reference internal" href="../2-EOS/EOS-2-SRK-PR.html"><span class="std std-doc">уравнение состояние Пенга-Робинсона</span></a> и его <a class="reference external" href="https://github.com/DanielSkorov/ReservoirSimulation/blob/main/_src/eos.py">реализацию</a>. Кроме того, для проверки стабильности системы будет применяться метод последовательных подстановок, алгоритм которого был рассмотрен <a class="reference internal" href="SEC-1-Stability.html"><span class="std std-doc">ранее</span></a>, реализованный <a class="reference external" href="https://github.com/DanielSkorov/ReservoirSimulation/blob/main/_src/stability.py">здесь</a>. Также на каждой итерации решения системы уравнений термодинамического равновесия необходимо решать <a class="reference internal" href="SEC-2-RR.html"><span class="std std-doc">уравнение Речфорда-Райса</span></a>. Для решения уравнения в двухфазной постановке будет использоваться <a class="reference external" href="https://github.com/DanielSkorov/ReservoirSimulation/blob/main/_src/rr.py">реализация</a> <a class="reference internal" href="SEC-3-RR-2P.html"><span class="std std-doc">метода FGH</span></a>, для решения системы уравнений Речфорда-Райса – модифицированный метод, основанный на рассмотренном <a class="reference internal" href="#SEC-3-RR-NP.md"><span class="xref myst">ранее</span></a> подходе [<a class="reference external" href="https://doi.org/10.2118/117752-PA">Okuno et al, 2010</a>], реализация которого представлена <a class="reference external" href="https://github.com/DanielSkorov/ReservoirSimulation/blob/main/_src/rr.py">здесь</a>.</p>
<p class="sd-card-text">Импортируем необходимые классы и функции.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../../_src/&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">eos</span> <span class="kn">import</span> <span class="n">pr78</span>
<span class="kn">from</span> <span class="nn">stability</span> <span class="kn">import</span> <span class="n">stabilityPT</span>
<span class="kn">from</span> <span class="nn">rr</span> <span class="kn">import</span> <span class="n">solve2p_FGH</span><span class="p">,</span> <span class="n">solveNp</span>
</pre></div>
</div>
<p class="sd-card-text">Зададим исходные термобарические условия и компонентный состав.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">P</span> <span class="o">=</span> <span class="mf">6e6</span> <span class="c1"># Pressure [Pa]</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">+</span> <span class="mf">273.15</span> <span class="c1"># Temperature [K]</span>
<span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">.9</span><span class="p">,</span> <span class="mf">.1</span><span class="p">])</span> <span class="c1"># Mole fractions [fr.]</span>
</pre></div>
</div>
<p class="sd-card-text">Также зададим максимальное число итераций <span class="math notranslate nohighlight">\(N_{iter}\)</span>, точность решения системы нелинейных уравнений <span class="math notranslate nohighlight">\(\epsilon\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">maxiter</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># Maximum number of iterations</span>
<span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="c1"># Tolerance</span>
</pre></div>
</div>
<p class="sd-card-text">Зададим свойства компонентов, необходимые для уравнения состояния Пенга-Робинсона, и выполним инициализацию класса.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Pci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">7.37646</span><span class="p">,</span> <span class="mf">4.600155</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="c1"># Critical pressures [Pa]</span>
<span class="n">Tci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">304.2</span><span class="p">,</span> <span class="mf">190.6</span><span class="p">])</span> <span class="c1"># Critical temperatures [K]</span>
<span class="n">wi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">.225</span><span class="p">,</span> <span class="mf">.008</span><span class="p">])</span> <span class="c1"># Acentric factors</span>
<span class="n">mwi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.04401</span><span class="p">,</span> <span class="mf">0.016043</span><span class="p">])</span> <span class="c1"># Molar mass [kg/gmole]</span>
<span class="n">vsi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span> <span class="c1"># Volume shift parameters</span>
<span class="n">dij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">.025</span><span class="p">])</span> <span class="c1"># Binary interaction parameters</span>
<span class="n">pr</span> <span class="o">=</span> <span class="n">pr78</span><span class="p">(</span><span class="n">Pci</span><span class="p">,</span> <span class="n">Tci</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">mwi</span><span class="p">,</span> <span class="n">vsi</span><span class="p">,</span> <span class="n">dij</span><span class="p">)</span>
</pre></div>
</div>
<p class="sd-card-text">Проиницилизируем класс для проведения теста стабильности и выполним проверку стабильности однофазного состояния:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stab</span> <span class="o">=</span> <span class="n">stabilityPT</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ss&#39;</span><span class="p">)</span>
<span class="n">stabres</span> <span class="o">=</span> <span class="n">stab</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stabres</span><span class="p">)</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>The one-phase state is stable:<br>False<br>Tangent-plane distance:<br>-0.01654261679172773
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">В результате проверки стабильности (путем вызова метода <code class="docutils literal notranslate"><span class="pre">run</span></code>) однофазное состояние системы оказалось нестабильным. Также был получен набор начальных приближений для решения нахождения решения системы нелинейных уравнений, определяющей положение локальных (для двухфазной системы) минимумов функции энергии Гиббса:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;kvji:</span><span class="se">\n</span><span class="si">{</span><span class="n">stabres</span><span class="o">.</span><span class="n">kvji</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>kvji:<br>(array([0.87776754, 2.10009211]), array([1.13925379, 0.47616959]))
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Создадим функцию, которая будет принимать на вход кортеж из результатов предыдущей итерации, точность и максимальное число итераций, и возвращать необходимость расчета следующей итерации цикла решения системы нелинейных уравнений термодинамического равновесия методом последовательных подстановок. Проиницилизируем данную функцию.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="k">def</span> <span class="nf">condit_ssi</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">maxiter</span><span class="p">):</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">kvi</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">gi</span> <span class="o">=</span> <span class="n">carry</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="n">maxiter</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">gi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span>

<span class="n">pcondit_ssi</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">condit_ssi</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">)</span>
</pre></div>
</div>
<p class="sd-card-text">Также создадим функцию, которая будет принимать на вход результаты предыдущей итерации в виде кортежа и рассчитывать результаты для новой итерации. Для расчета логарифмов летучести компонентов будем использовать метод <code class="docutils literal notranslate"><span class="pre">getPT_lnphii</span></code> инициализированного класса с уравнением состояния, принимающий на вход давление (в Па), температуру (в K) и компонентный состав в виде одномерного массива (размерностью <code class="docutils literal notranslate"><span class="pre">(Nc,)</span></code>) и возвращающий массив логарифмов коэффициентов летучести компонента такой же размерности.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_ssi_2p</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">plnphi</span><span class="p">):</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">kvi_k</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">gi_k</span> <span class="o">=</span> <span class="n">carry</span>
    <span class="n">kvi_kp1</span> <span class="o">=</span> <span class="n">kvi_k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">gi_k</span><span class="p">)</span>
    <span class="n">F1_kp1</span> <span class="o">=</span> <span class="n">solve2p_FGH</span><span class="p">(</span><span class="n">kvi_kp1</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
    <span class="n">y2i</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1_kp1</span> <span class="o">*</span> <span class="p">(</span><span class="n">kvi_kp1</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">y1i</span> <span class="o">=</span> <span class="n">y2i</span> <span class="o">*</span> <span class="n">kvi_kp1</span>
    <span class="n">lnphi2i</span> <span class="o">=</span> <span class="n">plnphi</span><span class="p">(</span><span class="n">yi</span><span class="o">=</span><span class="n">y2i</span><span class="p">)</span>
    <span class="n">lnphi1i</span> <span class="o">=</span> <span class="n">plnphi</span><span class="p">(</span><span class="n">yi</span><span class="o">=</span><span class="n">y1i</span><span class="p">)</span>
    <span class="n">gi_kp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kvi_kp1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lnphi1i</span> <span class="o">-</span> <span class="n">lnphi2i</span>
    <span class="k">return</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kvi_kp1</span><span class="p">,</span> <span class="n">F1_kp1</span><span class="p">,</span> <span class="n">gi_kp1</span>

<span class="n">pupdate_ssi_2p</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">update_ssi_2p</span><span class="p">,</span> <span class="n">yi</span><span class="o">=</span><span class="n">yi</span><span class="p">,</span> <span class="n">plnphi</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
<p class="sd-card-text">Найдем решение системы нелинейных уравнений с использованием метода последовательных подстановок.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kvi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stabres</span><span class="o">.</span><span class="n">kvji</span><span class="p">):</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="n">solve2p_FGH</span><span class="p">(</span><span class="n">kvi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
    <span class="n">y2i</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1</span> <span class="o">*</span> <span class="p">(</span><span class="n">kvi</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">y1i</span> <span class="o">=</span> <span class="n">y2i</span> <span class="o">*</span> <span class="n">kvi</span>
    <span class="n">lnphi2i</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y2i</span><span class="p">)</span>
    <span class="n">lnphi1i</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y1i</span><span class="p">)</span>
    <span class="n">gi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kvi</span><span class="p">)</span> <span class="o">+</span> <span class="n">lnphi1i</span> <span class="o">-</span> <span class="n">lnphi2i</span>
    <span class="n">carry</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">kvi</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">gi</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">pcondit_ssi</span><span class="p">(</span><span class="n">carry</span><span class="p">):</span>
        <span class="n">carry</span> <span class="o">=</span> <span class="n">pupdate_ssi_2p</span><span class="p">(</span><span class="n">carry</span><span class="p">)</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">kvi</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">gi</span> <span class="o">=</span> <span class="n">carry</span>
    <span class="n">gnorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">gi</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gnorm</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>
        <span class="n">y2i</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1</span> <span class="o">*</span> <span class="p">(</span><span class="n">kvi</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">y1i</span> <span class="o">=</span> <span class="n">y2i</span> <span class="o">*</span> <span class="n">kvi</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For the initial guess #</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">tolerance of equations: </span><span class="si">{</span><span class="n">gnorm</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">number of iterations: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">phase compositions:</span><span class="se">\n\t\t</span><span class="si">{</span><span class="n">y1i</span><span class="si">}</span><span class="se">\n\t\t</span><span class="si">{</span><span class="n">y2i</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">phase mole fractions: </span><span class="si">{</span><span class="n">F1</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="mf">1.</span><span class="o">-</span><span class="n">F1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">break</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>For the initial guess #0:<br>	tolerance of equations: 2.3732334259748374e-07<br>	number of iterations: 10<br>	phase compositions:<br>		[0.81827115 0.18172885]<br>		[0.91760691 0.08239309]<br>	phase mole fractions: 0.17724647557775627, 0.8227535244222437
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Выполним проверку стабильности найденного решения.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">stab</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y1i</span><span class="p">))</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>The one-phase state is stable:<br>True<br>Tangent-plane distance:<br>-1e-08
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Тест стабильности показал, что найденное решение соответствует равновесному состоянию. Проиллюстрируем данный пример графически. Для этого построим зависимость функции приведенной добавочной энергии Гиббса для первой фазы от компонентного состава и проведем касательную в точке с найденным равновесным составом этой фазы. Для расчета коэффициентов летучестей компонентов для различных составов будем использовать метод <code class="docutils literal notranslate"><span class="pre">getPT_lnphiji_Zj</span></code>, принимающий в качестве аргументов давление (в Па), температуру (в K) и набор компонентных составов в виде двумерного массива (размерностью <code class="docutils literal notranslate"><span class="pre">(Np,</span> <span class="pre">Nc)</span></code>, где <code class="docutils literal notranslate"><span class="pre">Np</span></code> – количество наборов компонентных составов, <code class="docutils literal notranslate"><span class="pre">Nc</span></code> – количество компонентов в каждом компонентном составе) и возвращающий соответствующие коэффициенты летучести компонентов в виде двумерного массива такой же размерности и коэффициенты сверхсжимаемости в виде одномерного массива для каждого компонентного состава.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yj1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">0.9999</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">yji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">yj1</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">yj1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">lnphiji</span><span class="p">,</span> <span class="n">Zj</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphiji_Zj</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">yji</span><span class="p">)</span>
<span class="n">lnfji</span> <span class="o">=</span> <span class="n">lnphiji</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="n">yji</span><span class="p">)</span>
<span class="n">Gj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vecdot</span><span class="p">(</span><span class="n">yji</span><span class="p">,</span> <span class="n">lnfji</span><span class="p">)</span>
</pre></div>
</div>
<p class="sd-card-text">Получим знаяения касательной, проведенной к функции приведенной добавочной энергии Гиббса. Для расчета логарифмов летучести компонентов будем использовать метод <code class="docutils literal notranslate"><span class="pre">getPT_lnfi</span></code>, принимающий на вход давление (в Па), температуру (в K) и компонентный состав в виде одномерного масива (размерностью <code class="docutils literal notranslate"><span class="pre">(Nc,)</span></code>) и возвращающий логарифмы летучести компонентов в виде одномерного массива такой же размерности.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lnfi</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnfi</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y1i</span><span class="p">)</span>
<span class="n">Lj</span> <span class="o">=</span> <span class="n">yji</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lnfi</span><span class="p">)</span>
</pre></div>
</div>
<p class="sd-card-text">Построим графики функции приведенной добавочной энергии Гиббса и касательной к ней.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yj1</span><span class="p">,</span> <span class="n">Gj</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Приведенная добавочная энергия Гиббса&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yj1</span><span class="p">,</span> <span class="n">Lj</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;orchid&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Касательная&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Количество вещества диоксида углерода в первой фазе, моль&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Приведенная добавочная энергия Гиббса&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">axins1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">([</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.975</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">14.5</span><span class="p">,</span> <span class="mf">15.1</span><span class="p">),</span>
                        <span class="n">xticklabels</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yj1</span><span class="p">,</span> <span class="n">Gj</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Приведенная добавочная</span><span class="se">\n</span><span class="s1">энергия Гиббса&#39;</span><span class="p">)</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yj1</span><span class="p">,</span> <span class="n">Lj</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;orchid&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Касательная&#39;</span><span class="p">)</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y1i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y1i</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lnfi</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y2i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y2i</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lnfi</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">y1i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y1i</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y1i</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lnfi</span><span class="p">)],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">y2i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y2i</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y2i</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lnfi</span><span class="p">)],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">14.55</span><span class="p">,</span> <span class="s1">&#39;$y_</span><span class="si">{CO_2}</span><span class="s1"> = 0.818$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">14.55</span><span class="p">,</span> <span class="s1">&#39;$x_</span><span class="si">{CO_2}</span><span class="s1"> = 0.918$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mf">0.8</span><span class="p">])</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">14.6</span><span class="p">,</span> <span class="mf">14.8</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">])</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axins1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/01fb9052dc335843681f4962a938ab200234fe13b5d675c9cf2a624fe0539139.png" src="../../_images/01fb9052dc335843681f4962a938ab200234fe13b5d675c9cf2a624fe0539139.png" />
<br>
<br>
<p class="sd-card-text">Из данного графика следует, что касательная, проведенная к функции энергии Гиббса в точке с компонентным составом первой фазы, не имеет пересечений с самой функцией, что подтверждает сделанный вывод о равновесности найденного состояния. Кроме того, можно отметить, что касательная имеет две точки касания, абсциссы которых соответствуют равновесным компонентным составам фаз, то есть функция энергии Гиббса имеет одинаковую касательную для каждого из компонентных составов, определяющих стационарное состояние. Это следует из равенства летучестей соответствующих компонентов в фазах, а полное доказательство данного утверждения было рассмотрено <a class="reference internal" href="SEC-1-Stability.html"><span class="std std-doc">ранее</span></a>. Стоит также отметить, что две точки, показанные на графике, соответствующие двухфазному равновесному состоянию, называются <em><strong>бинодальными точками</strong></em>.</p>
</div>
</details><p>Представленным выше примером было проиллюстрировано применение метода последовательных подстановок для расчета двухфазного равновесного состояния. Однако данный метод может применяться и для расчета многофазной системы. Рассмотрим следующий пример.</p>
<div class="exercise admonition">
<p class="admonition-title">Пример</p>
<p>Пусть имеется <span class="math notranslate nohighlight">\(1 \; моль\)</span> смеси из метана, гексана и воды при температуре <span class="math notranslate nohighlight">\(20 \; ^{\circ} C\)</span> и давлении <span class="math notranslate nohighlight">\(1 \; атм\)</span> с мольными долями компонентов <span class="math notranslate nohighlight">\(0.1, \, 0.6, \, 0.3\)</span> соответственно. Необходимо определить равновесное состояние системы.</p>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Решение</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Зададим исходные термобарические условия и компонентный состав.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mf">101325.</span> <span class="c1"># Pressure [Pa]</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">20.</span> <span class="o">+</span> <span class="mf">273.15</span> <span class="c1"># Temperature [K]</span>
<span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">.1</span><span class="p">,</span> <span class="mf">.6</span><span class="p">,</span> <span class="mf">.3</span><span class="p">])</span> <span class="c1"># Mole fractions [fr.]</span>
</pre></div>
</div>
<p class="sd-card-text">Зададим свойства компонентов, необходимые для уравнения состояния Пенга-Робинсона, и выполним инициализацию класса.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Pci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.600155</span><span class="p">,</span> <span class="mf">3.2890095</span><span class="p">,</span> <span class="mf">22.04832</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="c1"># Critical pressures [Pa]</span>
<span class="n">Tci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">190.6</span><span class="p">,</span> <span class="mf">507.5</span><span class="p">,</span> <span class="mf">647.3</span><span class="p">])</span> <span class="c1"># Critical temperatures [K]</span>
<span class="n">wi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">.008</span><span class="p">,</span> <span class="mf">.27504</span><span class="p">,</span> <span class="mf">.344</span><span class="p">])</span> <span class="c1"># Acentric factors</span>
<span class="n">mwi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.016043</span><span class="p">,</span> <span class="mf">0.086</span><span class="p">,</span> <span class="mf">0.018015</span><span class="p">])</span> <span class="c1"># Molar mass [kg/gmole]</span>
<span class="n">vsi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span> <span class="c1"># Volume shift parameters</span>
<span class="n">dij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">.0253</span><span class="p">,</span> <span class="mf">0.4907</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">])</span> <span class="c1"># Binary interaction parameters</span>
<span class="n">pr</span> <span class="o">=</span> <span class="n">pr78</span><span class="p">(</span><span class="n">Pci</span><span class="p">,</span> <span class="n">Tci</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">mwi</span><span class="p">,</span> <span class="n">vsi</span><span class="p">,</span> <span class="n">dij</span><span class="p">)</span>
</pre></div>
</div>
<p class="sd-card-text">Проиницилизируем класс для проведения теста стабильности и выполним проверку стабильности однофазного состояния.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># level=1 indicates an increased number of arrays of initial k-values</span>
<span class="n">stab</span> <span class="o">=</span> <span class="n">stabilityPT</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ss&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">stabres</span> <span class="o">=</span> <span class="n">stab</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stabres</span><span class="p">)</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>The one-phase state is stable:<br>False<br>Tangent-plane distance:<br>-1.0736853887123032
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Однофазное состояние оказалось нестабильным, выполним расчет двухфазного равновесного состояния. Для этого сначала проинициализируем функцию <code class="docutils literal notranslate"><span class="pre">update_ssi_2p</span></code> для рассматриваемого примера. Поскольку точность расчета и максимальное количество итераций не изменилось, то будем использовать функцию <code class="docutils literal notranslate"><span class="pre">pcondit_ssi</span></code> из предыдущего примера.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pupdate_ssi_2p</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">update_ssi_2p</span><span class="p">,</span> <span class="n">yi</span><span class="o">=</span><span class="n">yi</span><span class="p">,</span> <span class="n">plnphi</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
<p class="sd-card-text">Перебирая различные начальные приближения констант фазового равновесия, полученные после проверки стабильности однофазного состояния, найдем решение системы нелинейных уравнений, определяющей положение локальных минимумов функции энергии Гиббса в двухфазной постановке.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kvi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stabres</span><span class="o">.</span><span class="n">kvji</span><span class="p">):</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="n">solve2p_FGH</span><span class="p">(</span><span class="n">kvi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
    <span class="n">y2i</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1</span> <span class="o">*</span> <span class="p">(</span><span class="n">kvi</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">y1i</span> <span class="o">=</span> <span class="n">y2i</span> <span class="o">*</span> <span class="n">kvi</span>
    <span class="n">lnphi2i</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y2i</span><span class="p">)</span>
    <span class="n">lnphi1i</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y1i</span><span class="p">)</span>
    <span class="n">gi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kvi</span><span class="p">)</span> <span class="o">+</span> <span class="n">lnphi1i</span> <span class="o">-</span> <span class="n">lnphi2i</span>
    <span class="n">carry</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">kvi</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">gi</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">pcondit_ssi</span><span class="p">(</span><span class="n">carry</span><span class="p">):</span>
        <span class="n">carry</span> <span class="o">=</span> <span class="n">pupdate_ssi_2p</span><span class="p">(</span><span class="n">carry</span><span class="p">)</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">kvi</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">gi</span> <span class="o">=</span> <span class="n">carry</span>
    <span class="n">gnorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">gi</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gnorm</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>
        <span class="n">y2i</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1</span> <span class="o">*</span> <span class="p">(</span><span class="n">kvi</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">y1i</span> <span class="o">=</span> <span class="n">y2i</span> <span class="o">*</span> <span class="n">kvi</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For the initial guess #</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">tolerance of equations: </span><span class="si">{</span><span class="n">gnorm</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">number of iterations: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">phase compositions:</span><span class="se">\n\t\t</span><span class="si">{</span><span class="n">y1i</span><span class="si">}</span><span class="se">\n\t\t</span><span class="si">{</span><span class="n">y2i</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">phase mole fractions: </span><span class="si">{</span><span class="n">F1</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="mf">1.</span><span class="o">-</span><span class="n">F1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">break</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>For the initial guess #0:<br>	tolerance of equations: 6.277522443943676e-07<br>	number of iterations: 5<br>	phase compositions:<br>		[0.00105886 0.98875662 0.01018452]<br>		[0.20198554 0.1992814  0.59873305]<br>	phase mole fractions: 0.5075759028534098, 0.4924240971465902
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Метод последовательных подстановок нашел состояние, характеризующееся равенством летучестей соответствующих компонентов в фазах, за пять итераций. Проверим, является ли двухфазное состояние рассматриваемой системы стабильным. Для этого проведем тест стабильности для одной из фаз.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stabres</span> <span class="o">=</span> <span class="n">stab</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y2i</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stabres</span><span class="p">)</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>The one-phase state is stable:<br>False<br>Tangent-plane distance:<br>-3.425190016194752
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">По результатам проверки стабильности двухфазное состояние оказалось нестабильным, следовательно, необходимо рассмотреть трехфазное состояние.</p>
<p class="sd-card-text">С учетом изложенного выше подхода к определению начального приближения для расчета многофазного состояния сформируем матрицу констант фазового равновесия для первой итерации расчета трехфазного состояния.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">kvji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">kvi</span><span class="p">,</span> <span class="n">stabres</span><span class="o">.</span><span class="n">kvji</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;kvji:</span><span class="se">\n</span><span class="si">{</span><span class="n">kvji</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>kvji:<br>[[5.24225192e-03 4.96161010e+00 1.70101165e-02]<br> [1.09678544e-10 1.37290164e-21 1.67019341e+00]]
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Определим мольные доли фаз, соответствующие этому начальному приближению.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Fj</span> <span class="o">=</span> <span class="n">solveNp</span><span class="p">(</span><span class="n">kvji</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">F1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Fj</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>Fj = array([0.5075759, 0.       ])
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Рассчитаем компонентные составы фаз.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xi</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">Fj</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">kvji</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
<span class="n">yji</span> <span class="o">=</span> <span class="n">xi</span> <span class="o">*</span> <span class="n">kvji</span>
</pre></div>
</div>
<p class="sd-card-text">Выполним расчет коэффициентов летучестей для каждого компонента в каждой из фаз. Для этого воспользуемся методом <code class="docutils literal notranslate"><span class="pre">getPT_lnphiji_Zj</span></code> инициализированного класса с уравнением состояния.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lnphiji</span><span class="p">,</span> <span class="n">Zj</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphiji_Zj</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">yji</span><span class="p">,</span> <span class="n">xi</span><span class="p">]))</span>
</pre></div>
</div>
<p class="sd-card-text">Рассчитаем матрицу невязок.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kvji</span><span class="p">)</span> <span class="o">+</span> <span class="n">lnphiji</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lnphiji</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p class="sd-card-text">Создадим функцию, которая будет получать на вход результаты предыдущей итерации и возвращать результаты следующей итерации метода последовательных подстановок для задачи определения многофазного равновесного состояния.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_ssi_Np</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">plnphi</span><span class="p">):</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">kvji_k</span><span class="p">,</span> <span class="n">Fj_k</span><span class="p">,</span> <span class="n">gji_k</span> <span class="o">=</span> <span class="n">carry</span>
    <span class="n">kvji_kp1</span> <span class="o">=</span> <span class="n">kvji_k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">gji_k</span><span class="p">)</span>
    <span class="n">Fj_kp1</span> <span class="o">=</span> <span class="n">solveNp</span><span class="p">(</span><span class="n">kvji_kp1</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">Fj_k</span><span class="p">)</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">Fj_kp1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">kvji_kp1</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">yji</span> <span class="o">=</span> <span class="n">xi</span> <span class="o">*</span> <span class="n">kvji_kp1</span>
    <span class="n">lnphiji</span><span class="p">,</span> <span class="n">Zj</span> <span class="o">=</span> <span class="n">plnphi</span><span class="p">(</span><span class="n">yji</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">yji</span><span class="p">,</span> <span class="n">xi</span><span class="p">]))</span>
    <span class="n">gji_kp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kvji_kp1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lnphiji</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lnphiji</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kvji_kp1</span><span class="p">,</span> <span class="n">Fj_kp1</span><span class="p">,</span> <span class="n">gji_kp1</span>

<span class="n">pupdate_ssi_Np</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">update_ssi_Np</span><span class="p">,</span> <span class="n">yi</span><span class="o">=</span><span class="n">yi</span><span class="p">,</span> <span class="n">plnphi</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphiji_Zj</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
<p class="sd-card-text">В цикле <code class="docutils literal notranslate"><span class="pre">while</span></code> найдем решение системы нелинейных уравнений, определяющей положение локальных минимумов функции энергии Гиббса, соответствующих трехфазному состоянию системы.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">carry</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">kvji</span><span class="p">,</span> <span class="n">Fj</span><span class="p">,</span> <span class="n">gji</span><span class="p">)</span>

<span class="k">while</span> <span class="n">pcondit_ssi</span><span class="p">(</span><span class="n">carry</span><span class="p">):</span>
    <span class="n">carry</span> <span class="o">=</span> <span class="n">pupdate_ssi_Np</span><span class="p">(</span><span class="n">carry</span><span class="p">)</span>

<span class="n">k</span><span class="p">,</span> <span class="n">kvji</span><span class="p">,</span> <span class="n">Fj</span><span class="p">,</span> <span class="n">gji</span> <span class="o">=</span> <span class="n">carry</span>

<span class="n">xi</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">Fj</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">kvji</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
<span class="n">yji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xi</span> <span class="o">*</span> <span class="n">kvji</span><span class="p">,</span> <span class="n">xi</span><span class="p">])</span>
<span class="n">Fj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Fj</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">Fj</span><span class="o">.</span><span class="n">sum</span><span class="p">()])</span>
<span class="n">gnorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">gji</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Tolerance of equations: </span><span class="si">{</span><span class="n">gnorm</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="sa">f</span><span class="s1">&#39;Number of iterations: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="sa">f</span><span class="s1">&#39;Phase compositions:</span><span class="se">\n</span><span class="si">{</span><span class="n">yji</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="sa">f</span><span class="s1">&#39;Phase mole fractions: </span><span class="si">{</span><span class="n">Fj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>Tolerance of equations: 6.812284740341153e-07<br>Number of iterations: 4<br>Phase compositions:<br>[[4.06762262e-03 9.95611408e-01 3.20969073e-04]<br> [2.61399699e-09 8.46397875e-21 9.99999997e-01]<br> [7.79541597e-01 2.01162109e-01 1.92962948e-02]]<br>Phase mole fractions: [0.57733451 0.29739749 0.125268  ]
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Выполним проверку стабильности компонентного состава одной из фаз.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">stab</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">yji</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>The one-phase state is stable:<br>True<br>Tangent-plane distance:<br>-1e-08
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Тест стабильности показал, что определенное трехфазное состояние системы является равновесным.</p>
</div>
</details><p>Таким образом, данными примерами было проиллюстрировано применение метода последовательных подстановок для нахождения двух- и трехфазного равновесного состояния. Как и в случае с <a class="reference internal" href="SEC-1-Stability.html"><span class="std std-doc">анализом стабильности</span></a>, недостатком этого метода является сравнительно большое количество итераций и медленная сходимость для термодинамических систем, находящихся вблизи <a class="reference internal" href="SEC-6-Saturation.html"><span class="std std-doc">линии насыщения</span></a> или вблизи <a class="reference internal" href="SEC-7-Criticality.html"><span class="std std-doc">критической точки</span></a>. В качестве примера рассмотрим следующую задачу.</p>
<div class="exercise admonition">
<p class="admonition-title">Пример</p>
<p>Пусть имеется <span class="math notranslate nohighlight">\(1 \; моль\)</span> смеси следующего мольного состава:</p>
<div class="pst-scrollable-table-container"><table class="table" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Компонент</p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mathrm{CH_4}\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mathrm{C_2 H_6}\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mathrm{C_3 H_8}\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mathrm{n \mbox{-} C_4}\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mathrm{C_{5+}}\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p>Мольная доля</p></td>
<td class="text-center"><p>0.7167</p></td>
<td class="text-center"><p>0.0895</p></td>
<td class="text-center"><p>0.0917</p></td>
<td class="text-center"><p>0.0448</p></td>
<td class="text-center"><p>0.0573</p></td>
</tr>
</tbody>
</table>
</div>
<br>
<p>Необходимо определить равновесное состояние системы при давлении <span class="math notranslate nohighlight">\(17 \; МПа\)</span> и температуре <span class="math notranslate nohighlight">\(68 \; ^{\circ} C\)</span>.</p>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Решение</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Зададим исходные термобарические условия и компонентный состав.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mf">17e6</span> <span class="c1"># Pressure [Pa]</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">68.</span> <span class="o">+</span> <span class="mf">273.15</span> <span class="c1"># Temperature [K]</span>
<span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7167</span><span class="p">,</span> <span class="mf">0.0895</span><span class="p">,</span> <span class="mf">0.0917</span><span class="p">,</span> <span class="mf">0.0448</span><span class="p">,</span> <span class="mf">0.0573</span><span class="p">])</span> <span class="c1"># Mole fractions [fr.]</span>
</pre></div>
</div>
<p class="sd-card-text">Зададим свойства компонентов, необходимые для уравнения состояния Пенга-Робинсона, и выполним инициализацию класса.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Pci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.599</span><span class="p">,</span> <span class="mf">4.872</span><span class="p">,</span> <span class="mf">4.248</span><span class="p">,</span> <span class="mf">3.796</span><span class="p">,</span> <span class="mf">2.398</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="c1"># Critical pressures [Pa]</span>
<span class="n">Tci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">190.56</span><span class="p">,</span> <span class="mf">305.32</span><span class="p">,</span> <span class="mf">369.83</span><span class="p">,</span> <span class="mf">425.12</span><span class="p">,</span> <span class="mf">551.02</span><span class="p">])</span> <span class="c1"># Critical temperatures [K]</span>
<span class="n">wi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.012</span><span class="p">,</span> <span class="mf">0.100</span><span class="p">,</span> <span class="mf">0.152</span><span class="p">,</span> <span class="mf">0.200</span><span class="p">,</span> <span class="mf">0.414</span><span class="p">])</span> <span class="c1"># Acentric factors</span>
<span class="n">mwi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.016043</span><span class="p">,</span> <span class="mf">0.03007</span><span class="p">,</span> <span class="mf">0.044097</span><span class="p">,</span> <span class="mf">0.058123</span><span class="p">,</span> <span class="mf">0.120</span><span class="p">])</span> <span class="c1"># Molar mass [kg/gmole]</span>
<span class="n">vsi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1595</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1134</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0863</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0675</span><span class="p">,</span> <span class="mf">0.05661</span><span class="p">])</span> <span class="c1"># Volume shift parameters</span>
<span class="n">dij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="mf">0.002689</span><span class="p">,</span>
    <span class="mf">0.008537</span><span class="p">,</span> <span class="mf">0.001662</span><span class="p">,</span>
    <span class="mf">0.014748</span><span class="p">,</span> <span class="mf">0.004914</span><span class="p">,</span> <span class="mf">0.000866</span><span class="p">,</span>
    <span class="mf">0.039265</span><span class="p">,</span> <span class="mf">0.021924</span><span class="p">,</span> <span class="mf">0.011676</span><span class="p">,</span> <span class="mf">0.006228</span><span class="p">,</span>
<span class="p">])</span> <span class="c1"># Binary interaction parameters</span>
<span class="n">pr</span> <span class="o">=</span> <span class="n">pr78</span><span class="p">(</span><span class="n">Pci</span><span class="p">,</span> <span class="n">Tci</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">mwi</span><span class="p">,</span> <span class="n">vsi</span><span class="p">,</span> <span class="n">dij</span><span class="p">)</span>
</pre></div>
</div>
<p class="sd-card-text">Проиницилизируем класс для проведения теста стабильности и выполним проверку стабильности однофазного состояния:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stab</span> <span class="o">=</span> <span class="n">stabilityPT</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ss&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">stabres</span> <span class="o">=</span> <span class="n">stab</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stabres</span><span class="p">)</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>The one-phase state is stable:<br>False<br>Tangent-plane distance:<br>-0.0013880767269366222
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Однофазное состояние оказалось нестабильным. Найдем решение системы нелинейных уравнений, определяющей положение локальных минимумов функции энергии Гиббса для двухфазного состояния. Для этого сначала проинициализируем функцию <code class="docutils literal notranslate"><span class="pre">update_ssi_2p</span></code> для рассматриваемого примера.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pupdate_ssi_2p</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">update_ssi_2p</span><span class="p">,</span> <span class="n">yi</span><span class="o">=</span><span class="n">yi</span><span class="p">,</span> <span class="n">plnphi</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
<p class="sd-card-text">Увеличим максимальное количество итераций для функции <code class="docutils literal notranslate"><span class="pre">pcondit_ssi</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pcondit_ssi</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">condit_ssi</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">110</span><span class="p">)</span>
</pre></div>
</div>
<p class="sd-card-text">Перебирая различные начальные приближения констант фазового равновесия, полученные после проверки стабильности однофазного состояния, найдем решение системы нелинейных уравнений для двухфазного состояния.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kvi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stabres</span><span class="o">.</span><span class="n">kvji</span><span class="p">):</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="n">solve2p_FGH</span><span class="p">(</span><span class="n">kvi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
    <span class="n">y2i</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1</span> <span class="o">*</span> <span class="p">(</span><span class="n">kvi</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">y1i</span> <span class="o">=</span> <span class="n">y2i</span> <span class="o">*</span> <span class="n">kvi</span>
    <span class="n">lnphi2i</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y2i</span><span class="p">)</span>
    <span class="n">lnphi1i</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y1i</span><span class="p">)</span>
    <span class="n">gi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kvi</span><span class="p">)</span> <span class="o">+</span> <span class="n">lnphi1i</span> <span class="o">-</span> <span class="n">lnphi2i</span>
    <span class="n">carry</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">kvi</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">gi</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">pcondit_ssi</span><span class="p">(</span><span class="n">carry</span><span class="p">):</span>
        <span class="n">carry</span> <span class="o">=</span> <span class="n">pupdate_ssi_2p</span><span class="p">(</span><span class="n">carry</span><span class="p">)</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">kvi</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">gi</span> <span class="o">=</span> <span class="n">carry</span>
    <span class="n">gnorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">gi</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gnorm</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>
        <span class="n">y2i</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1</span> <span class="o">*</span> <span class="p">(</span><span class="n">kvi</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">y1i</span> <span class="o">=</span> <span class="n">y2i</span> <span class="o">*</span> <span class="n">kvi</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For the initial guess #</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">tolerance of equations: </span><span class="si">{</span><span class="n">gnorm</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">number of iterations: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">phase compositions:</span><span class="se">\n\t\t</span><span class="si">{</span><span class="n">y1i</span><span class="si">}</span><span class="se">\n\t\t</span><span class="si">{</span><span class="n">y2i</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">phase mole fractions: </span><span class="si">{</span><span class="n">F1</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="mf">1.</span><span class="o">-</span><span class="n">F1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">break</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>For the initial guess #0:<br>	tolerance of equations: 9.755304898408295e-07<br>	number of iterations: 99<br>	phase compositions:<br>		[0.5845987  0.09334222 0.11409629 0.06614514 0.14181765]<br>		[0.7264065  0.08921768 0.09005437 0.04323161 0.05108984]<br>	phase mole fractions: 0.06844829263328067, 0.9315517073667193
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Метод последовательных подстановок нашел состояние, характеризующееся равенством летучестей соответствующих компонентов в фазах, за 99 итераций. Проверим, является ли двухфазное состояние стабильным. Для этого проведем тест стабильности для одной из фаз:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stabres</span> <span class="o">=</span> <span class="n">stab</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y2i</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stabres</span><span class="p">)</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>The one-phase state is stable:<br>True<br>Tangent-plane distance:<br>-1e-08
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Тест стабильности показал, что найденное решение соответствует равновесному состоянию.</p>
</div>
</details><p>Таким образом, вблизи границы двухфазной области метод последовательных подстановок характеризуется медленной сходимостью. Для ускорения могут применяться различные модификации данного метода, представленные в работах [<a class="reference external" href="https://doi.org/10.1002/cjce.5450610414">Mehra et al, 1983</a>; <a class="reference external" href="https://doi.org/10.1016/0378-3812(84)80013-8">Nghiem and Li, 1984</a>].</p>
</section>
</section>
<section id="pvt-sec-equilibrium-pt-newton">
<span id="id5"></span><h3>Метод минимизации функции<a class="headerlink" href="#pvt-sec-equilibrium-pt-newton" title="Link to this heading">#</a></h3>
<p>Как уже было отмечено ранее, задачу определения равновесного состояния термодинамической системы для фиксированного количества фаз можно рассматривать как задачу локальной минимизации функции энергии Гиббса. Такой подход требует получение аналитических выражений для вектора градиента и матрицы гессиана оптимизируемой функции. Ранее в данном разделе было получено выражение элемента вектора градиента функции энергии Гиббса при использовании количеств вещества компонентов в нереференсных фазах в качестве основных переменных:</p>
<div class="math notranslate nohighlight">
\[ g_{ji} = \ln f_{ji} - \ln f_{N_pi}, \; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c. \]</div>
<p>Выразим летучесть <span class="math notranslate nohighlight">\(i\)</span>-го компонента в <span class="math notranslate nohighlight">\(j\)</span>-й фазе через его коэффициент летучести и количество вещества:</p>
<div class="math notranslate nohighlight">
\[ \ln f_{ji} = \ln \varphi_{ji} y_{ji} P = \ln \varphi_{ji} \frac{n_{ji}}{n_j} P = \ln \varphi_{ji} + \ln n_{ji} - \ln n_j + \ln P, \; j = 1 \, \ldots \, N_p, \; i = 1 \, \ldots \, N_c. \]</div>
<p>Тогда элемент вектора градиента:</p>
<div class="math notranslate nohighlight">
\[ g_{ji} = \ln \varphi_{ji} + \ln n_{ji} - \ln n_j - \left( \ln \varphi_{N_pi} + \ln n_{N_pi} - \ln n_{N_p} \right), \; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c. \]</div>
<p>Получим выражение для элемента матрицы гессиана:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{alignat}{1}
H_{jikl}
&amp;= &amp;&amp; \, \frac{\partial g_{ji}}{\partial n_{kl}} \\
&amp;= &amp;&amp; \, \frac{\partial \ln \varphi_{ji}}{\partial n_{kl}} + \frac{\partial \ln n_{ji}}{\partial n_{kl}} - \frac{\partial \ln n_j}{\partial n_{kl}} - \left( \frac{\partial \ln \varphi_{N_pi}}{\partial n_{kl}} + \frac{\partial \ln n_{N_pi}}{\partial n_{kl}} - \frac{\partial \ln n_{N_p}}{\partial n_{kl}} \right) , \\
&amp; &amp;&amp; \, j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c, \; k = 1 \, \ldots \, N_p - 1, \; l = 1 \, \ldots \, N_c.
\end{alignat} \end{split}\]</div>
<p>Рассмотрим и преобразуем некоторые слагаемые. Частная производная логарифма коэффициента летучести <span class="math notranslate nohighlight">\(i\)</span>-го компонента в <span class="math notranslate nohighlight">\(j\)</span>-й фазе, где <span class="math notranslate nohighlight">\(i = 1 \, \ldots \, N_c\)</span> и <span class="math notranslate nohighlight">\(j = 1 \, \ldots \, N_p - 1\)</span>, по количесту вещества <span class="math notranslate nohighlight">\(l\)</span>-го компонента в <span class="math notranslate nohighlight">\(k\)</span>-й фазе, где <span class="math notranslate nohighlight">\(l = 1 \, \ldots \, N_c\)</span> и <span class="math notranslate nohighlight">\(k = 1 \, \ldots \, N_p - 1\)</span>, будет зависеть от компонентного состава этой же фазы. Следовательно,</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
\frac{\partial \ln \varphi_{ji}}{\partial n_{kl}}
&amp;= \begin{cases} 0, \; &amp; j \neq k, \; j = 1 \, \ldots \, N_p - 1, \; k = 1 \, \ldots \, N_p - 1, \, i = 1 \, \ldots N_c, \, l = 1 \, \ldots \, N_c, \\ \frac{\partial \ln \varphi_{ji}}{\partial n_{kl}}, \; &amp; j = k, \; j = 1 \, \ldots \, N_p - 1, \; k = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots N_c, \; l = 1 \, \ldots \, N_c. \end{cases} \\
&amp;= \delta_{jk} \frac{\partial \ln \varphi_{ji}}{\partial n_{jl}}, \; j = 1 \, \ldots \, N_p - 1, \; k = 1 \, \ldots \, N_p - 1, \, i = 1 \, \ldots N_c, \, l = 1 \, \ldots \, N_c.
\end{align} \end{split}\]</div>
<p>В выражении выше символом <span class="math notranslate nohighlight">\(\delta_{jk}, \, j = 1 \, \ldots \, N_p - 1, \, k = 1 \, \ldots \, N_p - 1,\)</span> обозначается элемент <a class="reference external" href="https://en.wikipedia.org/wiki/Identity_matrix">единичной матрицы</a> (<a class="reference external" href="https://en.wikipedia.org/wiki/Kronecker_delta">дельты Кронекера</a>).</p>
<p>Аналитические выражения логарифмов коэффициента летучести компонента фазы по давлению, температуре и количеству вещества компонентов, находящихся в этой же фазе, с использованием уравнений состояния были рассмотрены <a class="reference internal" href="../2-EOS/EOS-Appendix-A-PD.html"><span class="std std-doc">ранее</span></a>.</p>
<p>Рассмотрим частную производную логарифма коливечества вещества <span class="math notranslate nohighlight">\(i\)</span>-го компонента в <span class="math notranslate nohighlight">\(j\)</span>-й фазе по количеству вещества <span class="math notranslate nohighlight">\(l\)</span>-го компонента в <span class="math notranslate nohighlight">\(k\)</span>-й фазе:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
\frac{\partial \ln n_{ji}}{\partial n_{kl}}
&amp;= \begin{cases} 0, \; &amp; j \neq k, \; j = 1 \, \ldots \, N_p - 1, \; k = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots N_c, \; l = 1 \, \ldots \, N_c, \\ \frac{1}{n_{ji}} \frac{\partial n_{ji}}{\partial n_{kl}}, \; &amp; j = k, \; j = 1 \, \ldots \, N_p - 1, \; k = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots N_c, \; l = 1 \, \ldots \, N_c. \end{cases} \\
&amp;= \delta_{jk} \frac{1}{n_{ji}} \frac{\partial n_{ji}}{\partial n_{jl}}, \; j = 1 \, \ldots \, N_p - 1, \; k = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots N_c, \; l = 1 \, \ldots \, N_c, \\
&amp;= \delta_{jk} \frac{1}{n_{ji}} \delta_{il} , \; j = 1 \, \ldots \, N_p - 1, \; k = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots N_c, \; l = 1 \, \ldots \, N_c.
\end{align} \end{split}\]</div>
<p>Рассмотрим частную производную логарифма количества вещества <span class="math notranslate nohighlight">\(j\)</span>-й фазы по количеству вещества <span class="math notranslate nohighlight">\(l\)</span>-го компонента в <span class="math notranslate nohighlight">\(k\)</span>-й фазе:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
\frac{\partial \ln n_j}{\partial n_{kl}}
&amp;= \begin{cases} 0, \; &amp; j \neq k, \; j = 1 \, \ldots \, N_p - 1, \; k = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots N_c, \; l = 1 \, \ldots \, N_c, \\ \frac{1}{n_j} \frac{\partial n_j}{\partial n_{kl}}, \; &amp; j = k, \; j = 1 \, \ldots \, N_p - 1, \; k = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots N_c, \; l = 1 \, \ldots \, N_c. \end{cases} \\
&amp;= \delta_{jk} \frac{1}{n_j}, \; j = 1 \, \ldots \, N_p - 1, \; k = 1 \, \ldots \, N_p - 1, \; l = 1 \, \ldots N_c.
\end{align} \end{split}\]</div>
<p>При получении данного выражения было использовано следующее преобразование частной производной логарифма количества вещества <span class="math notranslate nohighlight">\(j\)</span>-й фазы по количеству вещества <span class="math notranslate nohighlight">\(k\)</span>-го компонента в этой же фазе (<span class="math notranslate nohighlight">\(k=j\)</span>):</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
\frac{\partial \ln n_j}{\partial n_{jl}} = &amp; \, \frac{1}{n_j} \frac{\partial n_{j}}{\partial n_{jl}} = \frac{1}{n_j} \frac{\partial}{\partial n_{jl}} \left( \sum_{i=1}^{N_c} n_{ji} \right) = \frac{1}{n_j} \sum_{i=1}^{N_c} \frac{\partial n_{ji}}{\partial n_{jl}} = \frac{1}{n_j} \sum_{i=1}^{N_c} \delta_{il} = \frac{1}{n_j}, \\ &amp; j = 1 \, \ldots \, N_p - 1, \; l = 1 \, \ldots \, N_c.
\end{align} \end{split}\]</div>
<p>Получим аналитическое выражение частной производной логарифма коэффициента летучести <span class="math notranslate nohighlight">\(i\)</span>-го компонента в <span class="math notranslate nohighlight">\(N_p\)</span>-й фазе по количеству вещества <span class="math notranslate nohighlight">\(l\)</span>-го компонента в <span class="math notranslate nohighlight">\(k\)</span>-й фазе:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial \ln \varphi_{N_pi}}{\partial n_{kl}} = \frac{\partial \ln \varphi_{N_pi}}{\partial n_{N_pl}} \frac{\partial n_{N_pl}}{\partial n_{kl}}, \; k = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots N_c, \; l = 1 \, \ldots \, N_c. \]</div>
<p>В свою очередь, с учетом</p>
<div class="math notranslate nohighlight">
\[ n_{N_pl} = n_l - \sum_{j=1}^{N_p-1} n_{jl}, \; l = 1 \, \ldots \, N_c, \]</div>
<p>получим частную производную количества вещества <span class="math notranslate nohighlight">\(l\)</span>-го компонента в <span class="math notranslate nohighlight">\(N_p\)</span>-й фазе по количеству вещества этого же компонента в <span class="math notranslate nohighlight">\(k\)</span>-й фазе:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial n_{N_pl}}{\partial n_{kl}} = \frac{\partial n_l}{\partial n_{kl}} - \frac{\partial}{\partial n_{kl}} \left( \sum_{j=1}^{N_p-1} n_{jl} \right) = - \sum_{j=1}^{N_p-1} \frac{\partial n_{jl}}{\partial n_{kl}} = -1, \; k = 1 \, \ldots \, N_p - 1, \; l = 1 \, \ldots N_c. \]</div>
<p>Рассмотрим частную производную логарифма количества вещества <span class="math notranslate nohighlight">\(i\)</span>-го компонента в <span class="math notranslate nohighlight">\(N_p\)</span>-й фазе по количеству вещества <span class="math notranslate nohighlight">\(L\)</span>-го компонента в <span class="math notranslate nohighlight">\(k\)</span>-й фазе:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
\frac{\partial \ln n_{N_pi}}{\partial n_{kl}}
&amp;= \frac{1}{n_{N_pi}} \frac{\partial n_{N_pi}}{\partial n_{kl}} \\
&amp;= \frac{1}{n_{N_pi}} \frac{\partial}{\partial n_{kl}} \left( n_i - \sum_{j=1}^{N_p-1} n_{ji} \right) \\
&amp;= -\frac{1}{n_{N_pi}} \sum_{j=1}^{N_p-1} \frac{\partial n_{ji}}{\partial n_{kl}} \\
&amp;= -\frac{1}{n_{N_pi}} \delta_{il}, \; k = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots N_c, \; l = 1 \, \ldots N_c.
\end{align} \end{split}\]</div>
<p>Получим аналитическое выражение для частной производной логарифма количества вещества <span class="math notranslate nohighlight">\(N_p\)</span>-й фазы по количеству вещества <span class="math notranslate nohighlight">\(l\)</span>-го компонента в <span class="math notranslate nohighlight">\(k\)</span>-й фазе:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
\frac{\partial \ln n_{N_p}}{\partial n_{kl}}
&amp;= \frac{1}{n_{N_p}} \frac{\partial n_{N_p}}{\partial n_{kl}} \\
&amp;= \frac{1}{n_{N_p}} \frac{\partial}{\partial n_{kl}} \left( n - \sum_{j=1}^{N_p-1} n_j \right) \\
&amp;= - \frac{1}{n_{N_p}} \frac{\partial}{\partial n_{kl}} \left( \sum_{j=1}^{N_p-1} \sum_{i=1}^{N_c} n_{ji} \right) \\
&amp;= - \frac{1}{n_{N_p}} \sum_{j=1}^{N_p-1} \sum_{i=1}^{N_c} \frac{\partial n_{ji}}{\partial n_{kl}} \\
&amp;= - \frac{1}{n_{N_p}}, \; k = 1 \, \ldots \, N_p - 1, \; l = 1 \, \ldots N_c.
\end{align} \end{split}\]</div>
<p>С учетом изложенного выше получим аналитическое выражение для элемента матрицы гессиана:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
H_{jikl}
&amp;= \delta_{jk} \left( \frac{\partial \ln \varphi_{ji}}{\partial n_{jl}} + \frac{1}{n_j} \left( \frac{\delta_{il}}{y_{ji}} - 1 \right) \right) + \left( \frac{\partial \ln \varphi_{N_pi}}{\partial n_{N_pl}} + \frac{1}{n_{N_p}} \left( \frac{\delta_{il}}{y_{N_pi}} - 1 \right) \right) \\
&amp;= \delta_{jk} \frac{\partial \ln f_{ji}}{\partial n_{jl}} + \frac{\partial \ln f_{N_pi}}{\partial n_{N_pl}} \\
&amp;= \delta_{jk} \frac{\partial \ln \varphi_{ji}}{\partial n_{jl}} + \frac{\partial \ln \varphi_{N_pi}}{\partial n_{N_pl}} + \delta_{jk} \left( \frac{\delta_{il}}{n_{ji}} - \frac{1}{n_j} \right) + \frac{\delta_{il}}{n_{N_pi}} - \frac{1}{n_{N_p}} \\
&amp;= \Phi_{jikl} + U_{jikl}, \; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c, \; k = 1 \, \ldots \, N_p - 1, \; l = 1 \, \ldots \, N_c,
\end{align} \end{split}\]</div>
<p>где:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{alignat}{1}
&amp; \Phi_{jikl} = &amp;&amp; \, \delta_{jk} \frac{\partial \ln \varphi_{ji}}{\partial n_{jl}} + \frac{\partial \ln \varphi_{N_pi}}{\partial n_{N_pl}}, \; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c, \; k = 1 \, \ldots \, N_p - 1, \; l = 1 \, \ldots \, N_c, \\
&amp; U_{jikl} = &amp;&amp; \, \delta_{jk} \left( \frac{\delta_{il}}{n_{ji}} - \frac{1}{n_j} \right) + \frac{\delta_{il}}{n_{N_pi}} - \frac{1}{n_{N_p}}, \\ &amp;&amp;&amp; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c, \; k = 1 \, \ldots \, N_p - 1, \; l = 1 \, \ldots \, N_c.
\end{alignat} \end{split}\]</div>
<p>Для двухфазной системы, состоящей из газовой <span class="math notranslate nohighlight">\(V\)</span> и референсной жидкой <span class="math notranslate nohighlight">\(L\)</span> фаз, элемент матрицы гессиана:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
H_{il}
&amp;= \frac{\partial \ln \varphi_{Vi}}{\partial n_{Vl}} + \frac{\partial \ln \varphi_{Li}}{\partial n_{Ll}} + \delta_{il} \left( \frac{1}{n_{Vi}} + \frac{1}{n_{Li}} \right) - \left( \frac{1}{n_V} + \frac{1}{n_L} \right) \\
&amp;= \frac{\partial \ln \varphi_{Vi}}{\partial n_{Vl}} + \frac{\partial \ln \varphi_{Li}}{\partial n_{Ll}} + \delta_{il} \frac{n_i}{n_{Vi} n_{Li}} - \frac{n}{n_V n_L} \\
&amp;= \Phi_{il} + U_{il}, \; i = 1 \, \ldots \, N_c, \; l = 1 \, \ldots \, N_c.
\end{align} \end{split}\]</div>
<p>где:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
&amp; \Phi_{il} = \frac{\partial \ln \varphi_{Vi}}{\partial n_{Vl}} + \frac{\partial \ln \varphi_{Li}}{\partial n_{Ll}}, \; i = 1 \, \ldots \, N_c, \; l = 1 \, \ldots \, N_c, \\
&amp; U_{il} = \delta_{il} \frac{n_i}{n_{Vi} n_{Li}} - \frac{n}{n_V n_L} = \frac{1}{n_V n_L} \left( \delta_{il} \frac{n_i}{y_{Vi} y_{Li}} - n \right), \; i = 1 \, \ldots \, N_c, \; l = 1 \, \ldots \, N_c.
\end{align} \end{split}\]</div>
<p>При использовании метода минимизации функции энергии Гиббса относительно основных переменных – вектора количеств вещества компонентов в нереференсных фазах – вектор обновления основных переменных определяется при решении следующей системы линейных уравнений:</p>
<div class="math notranslate nohighlight">
\[ \mathbf{H} \Delta \mathbf{n} = - \mathbf{g}, \]</div>
<p>где <span class="math notranslate nohighlight">\(\mathbf{H} \in {\rm I\!R}^{\left(N_c \cdot \left(N_p - 1\right) \right) \times \left(N_c \cdot \left(N_p - 1\right) \right)}\)</span> представляет собой матрицу гессиана, <span class="math notranslate nohighlight">\(\Delta \mathbf{n} \in {\rm I\!R}^{N_c \cdot \left(N_p - 1\right)}\)</span> – вектор обновления основных переменных (количеств вещества компонентов в нереференсных фазах), <span class="math notranslate nohighlight">\(\mathbf{g} \in {\rm I\!R}^{N_c \cdot \left(N_p - 1\right)}\)</span> – вектор значений решаемой системы нелинейных уравнений, определяющих положение стационарных точек функции энергии Гиббса (ее градиент).</p>
<p>Помимо вектора количеств вещества компонентов в нереференсных фазах в качестве основных переменных может выступить вектор логарифмов констант фазового равновесия компонентов в нереференсных фазах. В этом случае на каждой итерации метода Ньютона для нахождения вектора обновления основных переменных необходимо решать следующую систему линейных уравнений:</p>
<div class="math notranslate nohighlight">
\[ \mathbf{J} \Delta \ln \mathbf{k} = - \mathbf{g}, \]</div>
<p>где <span class="math notranslate nohighlight">\(\Delta \ln \mathbf{k} \in {\rm I\!R}^{N_c \cdot \left(N_p - 1\right)}\)</span> – вектор обновления основных переменных (логарифмов констант фазового равновесия компонентов в нереференсных фазах), <span class="math notranslate nohighlight">\(\mathbf{J} \in {\rm I\!R}^{\left(N_c \cdot \left(N_p - 1\right) \right) \times \left(N_c \cdot \left(N_p - 1\right) \right)}\)</span> представляет собой якобиан – матрицу частных производных, элемент которой определяется следующим выражением:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
J_{jikl} = &amp; \, \frac{\partial g_{ji}}{\partial \ln K_{kl}} = \sum_{r=1}^{N_p-1} \sum_{s=1}^{N_c} \frac{\partial g_{ji}}{\partial n_{rs}} \frac{\partial n_{rs}}{\partial \ln K_{kl}} = \sum_{r=1}^{N_p-1} \sum_{s=1}^{N_c} H_{jirs} U_{rskl}^{-1}, \\
&amp; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c, \; k = 1 \, \ldots \, N_p - 1, \; l = 1 \, \ldots \, N_c.
\end{align} \end{split}\]</div>
<p>При преобразовании данного выражения использовалось <a class="reference external" href="https://en.wikipedia.org/wiki/Chain_rule#General_rule:_Vector-valued_functions_with_multiple_inputs">правило нахождения производной сложной функции от нескольких переменных</a>.</p>
<p>Покажем, что частная производная логарифма константы фазового равновесия <span class="math notranslate nohighlight">\(i\)</span>-го компонента в <span class="math notranslate nohighlight">\(j\)</span>-й фазе, <span class="math notranslate nohighlight">\(i = 1 \, \ldots \, N_c, \, j = 1 \, \ldots \, N_p - 1\)</span>, по количеству вещества <span class="math notranslate nohighlight">\(l\)</span>-го компонента в <span class="math notranslate nohighlight">\(k\)</span>-й фазе, <span class="math notranslate nohighlight">\(l = 1 \, \ldots \, N_c, \, k = 1 \, \ldots \, N_p - 1\)</span>, соответствует элементу матрицы <span class="math notranslate nohighlight">\(U_{jikl}\)</span>, представляющей собой слагаемое в полученном ранее выражении для элемента гессиана.</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
\frac{\partial \ln K_{ji}}{\partial n_{kl}}
&amp;= \frac{\partial}{\partial n_{kl}} \left( \ln \frac{y_{ji}}{y_{N_pi}} \right) \\
&amp;= \frac{\partial}{\partial n_{kl}} \left( \ln \frac{n_{ji} n_{N_p}}{n_j n_{N_pi}} \right) \\
&amp;= \frac{\partial}{\partial n_{kl}} \left( \ln n_{ji} - \ln n_j - \ln n_{N_pi} + \ln n_{N_p} \right) \\
&amp;= \frac{\partial \ln n_{ji}}{\partial n_{kl}} - \frac{\partial \ln n_j}{\partial n_{kl}} - \frac{\partial \ln n_{N_pi}}{\partial n_{kl}} + \frac{\partial \ln n_{N_p}}{\partial n_{kl}} \\
&amp;= \delta_{jk} \frac{1}{n_{ji}} \delta_{il}  - \delta_{jk} \frac{1}{n_j} + \frac{1}{n_{N_pi}} \delta_{il} - \frac{1}{n_{N_p}} \\
&amp;= \delta_{jk} \left( \frac{\delta_{il}}{n_{ji}} - \frac{1}{n_j} \right) + \frac{\delta_{il}}{n_{N_pi}} - \frac{1}{n_{N_p}} \\
&amp;= U_{jikl}, \; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c, \; k = 1 \, \ldots \, N_p - 1, \; l = 1 \, \ldots \, N_c.
\end{align} \end{split}\]</div>
<p>Следовательно, частная производная количества вещества <span class="math notranslate nohighlight">\(i\)</span>-го компонента в <span class="math notranslate nohighlight">\(j\)</span>-й фазе, <span class="math notranslate nohighlight">\(i = 1 \, \ldots \, N_c, \, j = 1 \, \ldots \, N_p - 1\)</span>, по логарифму константы фазового равновесия <span class="math notranslate nohighlight">\(l\)</span>-го компонента в <span class="math notranslate nohighlight">\(k\)</span>-й фазе, <span class="math notranslate nohighlight">\(l = 1 \, \ldots \, N_c, \, k = 1 \, \ldots \, N_p - 1\)</span>, соответствует элементу обратной матрицы <span class="math notranslate nohighlight">\(U_{jikl}^{-1}\)</span>.</p>
<p>Важно отметить, что матрица гессиана <span class="math notranslate nohighlight">\(H \in {\rm I\!R}^{\left(N_c \cdot \left(N_p - 1\right) \right) \times \left(N_c \cdot \left(N_p - 1\right) \right)}\)</span> представляет собой симметричную матрицу, в отличие от матрицы якобиана <span class="math notranslate nohighlight">\(\mathbf{J} \in {\rm I\!R}^{\left(N_c \cdot \left(N_p - 1\right) \right) \times \left(N_c \cdot \left(N_p - 1\right) \right)}\)</span>. Согласно [<a class="reference external" href="https://doi.org/10.1016/0378-3812(82)85002-4">Michelsen, 1982</a>], данное свойство матрицы гессиана можно учитывать для более быстрого решения системы линейных уравнений, используя подходящие алгоритмы, например, <a class="reference external" href="https://en.wikipedia.org/wiki/Cholesky_decomposition">разложение Шолески</a> или, если матрица гессиана не является положительно определенной матрицей, модифицированное разложение Шолески, алгоритмы которого представлены в работах [<a class="reference external" href="https://doi.org/10.1137/0911064">Schnabel and Eskow, 1990</a>] и [<a class="reference external" href="https://doi.org/10.1137/S105262349833266X">Schnabel and Eskow, 1999</a>]. После нахождения вектора обновления количеств вещества компонентов в нереференсных фазах <span class="math notranslate nohighlight">\(\Delta \mathbf{n} \in {\rm I\!R}^{N_c \cdot \left(N_p - 1\right)}\)</span> вектор обновления логарифмов констант фазового равновесия компонентов в нереференсных фазах <span class="math notranslate nohighlight">\(\Delta \ln \mathbf{k} \in {\rm I\!R}^{N_c \cdot \left(N_p - 1\right)}\)</span> может быть определен с использованием следующего выражения:</p>
<div class="math notranslate nohighlight">
\[ \Delta \ln \mathbf{k} = - \mathbf{J}^{-1} \mathbf{g} = - \left( \mathbf{H} \mathbf{U}^{-1} \right)^{-1} \mathbf{g} = - \mathbf{U} \mathbf{H}^{-1} \mathbf{g} = \mathbf{U} \left( -\mathbf{H}^{-1} \mathbf{g} \right) = \mathbf{U} \Delta \mathbf{n}. \]</div>
<p>В процессе преобразования использовались некоторые <a class="reference external" href="https://en.wikipedia.org/wiki/Invertible_matrix#Other_properties">свойства обратных матриц</a>.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition- admonition">
<p class="admonition-title">Дополнительно</p>
<p>Число обусловленности некоторой матрицы <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> является ее свойством и, грубо говоря, характеризует то, насколько сильно изменится решение системы линейных уравнений <span class="math notranslate nohighlight">\(\mathbf{A} \mathbf{x} = \mathbf{b}\)</span> при некотором изменении вектора <span class="math notranslate nohighlight">\(\mathbf{b}\)</span>. При больших значениях числа обусловленности даже небольшие изменения вектора <span class="math notranslate nohighlight">\(\mathbf{b}\)</span> могут вызвать существенные изменения вектора <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>, поэтому если число обусловленности матрицы <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> невелико, то такая матрица называется <em>хорошо обусловленной (well-conditioned)</em>, и наоборот при большом числе обусловленности матрица называется <em>плохо обусловленной (ill-conditioned)</em>. Подробнее данное свойство матриц было рассмотрено <a class="reference internal" href="../../0-Math/0-LAB/LAB-11-ConditionNumber.html"><span class="std std-doc">ранее</span></a>.</p>
</div>
</aside>
<p>Сравнивая представленные формулировки метода локальной минимизации функции энергии Гиббса, необходимо отметить, что очевидным преимуществом использования вектора количеств вещества компонентов в качестве основных переменных является отсутствие необходимости решения уравнения (или системы уравнений) Речфорда-Райса: в этом случае мольные доли компонентов в фазах и мольные доли фаз могут быть получены напрямую из вектора основных переменных. С другой стороны, преимуществом использования логарифмов констант фазового равновесия в качестве основных переменных является то обстоятельство, что матрица <span class="math notranslate nohighlight">\(\mathbf{J}\)</span> характеризуется меньшим значением <a class="reference external" href="https://en.wikipedia.org/wiki/Condition_number">числа обусловленности</a>, по сравнению с матрицей <span class="math notranslate nohighlight">\(\mathbf{H}\)</span>, то есть матрица <span class="math notranslate nohighlight">\(\mathbf{J}\)</span> является хорошо обусловленной [<a class="reference external" href="https://doi.org/10.1016/j.fluid.2014.11.017">Petitfrere and Nichita, 2015</a>].</p>
<!-- TODO: Показать изменение числа обусловленности матриц J и H в зависимости от давления. См.: 10.1016/j.fluid.2014.11.017. -->
<!-- TODO: Показать изменение количества итераций с ростом давления для методов последовательных подстановок, Ньютона с гессианом H и Ньютона с якобианом J. См.: 10.1016/j.fluid.2014.11.017. Показать, почему метод последовательных подстановок плохо сходится вблизи линии насыщения или критической точки. -->
<section id="pvt-sec-equilibrium-pt-newton-init">
<span id="id6"></span><h4>Начальные приближения<a class="headerlink" href="#pvt-sec-equilibrium-pt-newton-init" title="Link to this heading">#</a></h4>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition- admonition">
<p class="admonition-title">Дополнительно</p>
<p>Алгоритмы оптимизации могут быть классифицированы по порядку производной целевой функции, которую они используют в расчете изменения основных переменных. Так, например, метод градиентного спуска использует производные первого порядка целевой функции (градиент), поэтому его относят к методам первого порядка. Метод Ньютона использует производные второго порядка целевой функции (гессиан), поэтому он относится к методам второго порядка. Существуют также и алгоритмы нулевого порядка, при применении которых производные вообще не используются <em>(derivative-free methods)</em>. При этом порядок алгоритма <em>(order of an algorithm)</em> в теории соотносится с порядком (скоростью) сходимости <em>(rate of convergence)</em>, однако, зачастую, это справедливо только вблизи решения (подробнее рассматривалось в <a class="reference internal" href="../../0-Math/1-OM/OM-0-Introduction.html"><span class="std std-doc">разделе про методы оптимизации функций</span></a>). Реальная же скорость сходимости зависит от начального приближения, вида оптимизируемой функции и др. На практике для оценки скорости сходимости используют <a class="reference external" href="https://en.wikipedia.org/wiki/Rate_of_convergence#Order_estimation">это</a> выражение.</p>
</div>
</aside>
<p>Таким образом, после получения аналитических выражений для элементов матриц гессиана и якобиана необходимо отметить, что к преимуществам использования метода Ньютона для локальной минимизации функции энергии Гиббса в процессе нахождения равновесного состояния относят его более быструю сходимость, поскольку данный метод является методом второго порядка, по сравнению с методом последовательных подстановок, относимым к методам первого порядка. Однако недостаток метода Ньютона заключается в меньшей стабильности и необходимости получения достаточно хорошего начального приближения. Как и для метода последовальных подстановок, начальное приближение для метода Ньютона может быть получено из результатов стабильности <span class="math notranslate nohighlight">\(\left(N_p - 1 \right)\)</span>-фазового состояния. Кроме того, могут быть использованы комбинированные методы, заключающиеся в выполнении нескольких итераций метода последовательных подстановок перед переключением на метод Ньютона. В качестве критериев переключения авторами работы [<a class="reference external" href="https://doi.org/10.2118/9232-PA">Mehra et al, 1982</a>] были предложены следующие:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{cases}
\sum_{j=1}^{N_p-1} \sum_{i=1}^{N_c} g_{ji} \leq 10^{-4}, \\
\max_j \left| \frac{F_j^k - F_j^{k-1}}{F_j^{k-1}} \right| \leq 0.01 \lambda^k, \\
\sum_{j=1}^{N_p-1} L_j^2 \leq 10^{-8},
\end{cases} \end{split}\]</div>
<p>где:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
&amp; g_{ji} = \ln K_{ji} + \ln \varphi_{ji} - \ln \varphi_{N_pi}, \; j = 1 \, \ldots \, N_p - 1, \; i = 1 \, \ldots \, N_c, \\
&amp; L_j = \sum_{i=1}^{N_c} \left( y_{ji} - y_{N_pi} \right), \; j = 1 \, \ldots \, N_p - 1.
\end{align} \end{split}\]</div>
<p>Несколько иные условия переключения на методы второго порядка были предложены авторами работы [<a class="reference external" href="https://doi.org/10.2118/8285-PA">Nghiem et al, 1983</a>]:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{cases}
\frac{\left( \mathbf{g}^\top \mathbf{g} \right)^k}{\left( \mathbf{g}^\top \mathbf{g} \right)^{k-1}} &gt; \epsilon_R, \\
\left| F_V^k - F_V^{k-1} \right| &lt; \epsilon_V, \\
\epsilon_L &lt; \left( \mathbf{g}^\top \mathbf{g} \right)^k &lt; \epsilon_U, \\
0 &lt; F_V^k &lt; 1.
\end{cases} \end{split}\]</div>
<p>Первые два критерия свидетельствуют о медленной сходимости метода последовательных подстановок. Третий критерий показывает диапазон длины вектора невязок, при котором, по мнению авторов, наиболее рационально осуществлять переключение на метод Ньютона. Верхняя граница диапазона предотвращает преждевременное переключение на методы второго порядка. Несмотря на то что вблизи решения порядок сходимости метода Ньютона превышает порядок сходимости метода последовательных подстановок, переключение с одного метода на другой не является целесообразным непосредственно вблизи решения, что обуславливает введение нижней границы в третьем условии. Наконец, последний критерий не допускает переключение на метод Ньютона, когда значения мольной доли одной из фаз равны нулю, принимая во внимание особенности задания начальных приближений, а также выражение для матрицы <span class="math notranslate nohighlight">\(\mathbf{U}\)</span>. Типовые значения параметров: <span class="math notranslate nohighlight">\(\epsilon_R = 0.6, \, \epsilon_V = 10^{-2}, \, \epsilon_L = 10^{-5}, \, \epsilon_U = 10^{-3}\)</span>.</p>
</section>
<section id="pvt-sec-equilibrium-pt-newton-examples">
<span id="id7"></span><h4>Примеры<a class="headerlink" href="#pvt-sec-equilibrium-pt-newton-examples" title="Link to this heading">#</a></h4>
<p>Проиллюстрируем применение метода локальной минимизации энергии Гиббса для нахождения равновесного состояния системы следующим примером.</p>
<div class="exercise admonition">
<p class="admonition-title">Пример</p>
<p>Пусть имеется <span class="math notranslate nohighlight">\(1 \; моль\)</span> смеси следующего мольного состава:</p>
<div class="pst-scrollable-table-container"><table class="table" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Компонент</p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mathrm{CH_4}\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mathrm{C_2 H_6}\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mathrm{C_3 H_8}\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mathrm{n \mbox{-} C_4}\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mathrm{C_{5+}}\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p>Мольная доля</p></td>
<td class="text-center"><p>0.7167</p></td>
<td class="text-center"><p>0.0895</p></td>
<td class="text-center"><p>0.0917</p></td>
<td class="text-center"><p>0.0448</p></td>
<td class="text-center"><p>0.0573</p></td>
</tr>
</tbody>
</table>
</div>
<br>
<p>Необходимо определить равновесное состояние системы при давлении <span class="math notranslate nohighlight">\(17 \; МПа\)</span> и температуре <span class="math notranslate nohighlight">\(68 \; ^{\circ} C\)</span>.</p>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Решение</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Зададим исходные термобарические условия и компонентный состав.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mf">17e6</span> <span class="c1"># Pressure [Pa]</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">68.</span> <span class="o">+</span> <span class="mf">273.15</span> <span class="c1"># Temperature [K]</span>
<span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7167</span><span class="p">,</span> <span class="mf">0.0895</span><span class="p">,</span> <span class="mf">0.0917</span><span class="p">,</span> <span class="mf">0.0448</span><span class="p">,</span> <span class="mf">0.0573</span><span class="p">])</span> <span class="c1"># Mole fractions [fr.]</span>
</pre></div>
</div>
<p class="sd-card-text">Для выполнения вычислений будем использовать свойства компонентов, а также проинициализированные классы с уравнением состояния и тестом стабильности при рассмотрении предыдущего примера.</p>
<p class="sd-card-text">Для данной термодинамической системы однофазное состояние системы не является стабильным:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stabres</span> <span class="o">=</span> <span class="n">stab</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stabres</span><span class="p">)</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>The one-phase state is stable:<br>False<br>Tangent-plane distance:<br>-0.0013880767269366222
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Выполним расчет двухфазного равновесного состояния с использованием метода локальной минимизации энергии Гиббса. Для этого создадим функцию, которая будет принимать на вход результаты предыдущей итерации в виде кортежа и рассчитывать результаты для новой итерации. Для расчета логарифмов летучести компонентов и их частных производных по количеству вещества компонентов будем использовать метод <code class="docutils literal notranslate"><span class="pre">getPT_lnphii_Z_dnj</span></code> инициализированного класса с уравнением состояния, принимающий на вход давление (в Па), температуру (в K), компонентный состав в виде одномерного массива (размерностью <code class="docutils literal notranslate"><span class="pre">(Nc,)</span></code>) и количество вещества фазы (в моль) и возвращающий кортеж из массива логарифмов коэффициентов летучести компонентов (размерностью <code class="docutils literal notranslate"><span class="pre">(Nc,)</span></code>), коэффициент сверхсжимаемости фазы, а также матрицу частных производных логарифмов коэффициентов летучести компонентов по их количеству вещества (размерностью <code class="docutils literal notranslate"><span class="pre">(Nc,</span> <span class="pre">Nc)</span></code>). Для решения системы линейных уравнений будем использовать <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.solve.html"><code class="docutils literal notranslate"><span class="pre">numpy.linalg.solve</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_newton_2p</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">plnphi</span><span class="p">):</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">lnkvi_k</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">H_k</span><span class="p">,</span> <span class="n">U_k</span><span class="p">,</span> <span class="n">gi_k</span> <span class="o">=</span> <span class="n">carry</span>
    <span class="n">dn1i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">H_k</span><span class="p">,</span> <span class="o">-</span><span class="n">gi_k</span><span class="p">)</span>
    <span class="n">dlnkvi</span> <span class="o">=</span> <span class="n">U_k</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dn1i</span><span class="p">)</span>
    <span class="n">lnkvi_kp1</span> <span class="o">=</span> <span class="n">lnkvi_k</span> <span class="o">+</span> <span class="n">dlnkvi</span>
    <span class="n">kvi_kp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lnkvi_kp1</span><span class="p">)</span>
    <span class="n">F1_kp1</span> <span class="o">=</span> <span class="n">solve2p_FGH</span><span class="p">(</span><span class="n">kvi_kp1</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
    <span class="n">F2_kp1</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">F1_kp1</span>
    <span class="n">y2i</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1_kp1</span> <span class="o">*</span> <span class="p">(</span><span class="n">kvi_kp1</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">y1i</span> <span class="o">=</span> <span class="n">y2i</span> <span class="o">*</span> <span class="n">kvi_kp1</span>
    <span class="n">lnphi2i</span><span class="p">,</span> <span class="n">Z2</span><span class="p">,</span> <span class="n">dlnphi2idn2j</span> <span class="o">=</span> <span class="n">plnphi</span><span class="p">(</span><span class="n">yi</span><span class="o">=</span><span class="n">y2i</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">F2_kp1</span><span class="p">)</span>
    <span class="n">lnphi1i</span><span class="p">,</span> <span class="n">Z1</span><span class="p">,</span> <span class="n">dlnphi1idn1j</span> <span class="o">=</span> <span class="n">plnphi</span><span class="p">(</span><span class="n">yi</span><span class="o">=</span><span class="n">y1i</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">F1_kp1</span><span class="p">)</span>
    <span class="n">gi_kp1</span> <span class="o">=</span> <span class="n">lnkvi_kp1</span> <span class="o">+</span> <span class="n">lnphi1i</span> <span class="o">-</span> <span class="n">lnphi2i</span>
    <span class="n">U_kp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diagflat</span><span class="p">(</span><span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">y1i</span> <span class="o">*</span> <span class="n">y2i</span><span class="p">))</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1_kp1</span> <span class="o">*</span> <span class="n">F2_kp1</span><span class="p">)</span>
    <span class="n">H_kp1</span> <span class="o">=</span> <span class="n">dlnphi1idn1j</span> <span class="o">+</span> <span class="n">dlnphi2idn2j</span> <span class="o">+</span> <span class="n">U_kp1</span>
    <span class="k">return</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lnkvi_kp1</span><span class="p">,</span> <span class="n">F1_kp1</span><span class="p">,</span> <span class="n">H_kp1</span><span class="p">,</span> <span class="n">U_kp1</span><span class="p">,</span> <span class="n">gi_kp1</span>

<span class="n">pupdate_newton_2p</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
  <span class="n">update_newton_2p</span><span class="p">,</span>
  <span class="n">yi</span><span class="o">=</span><span class="n">yi</span><span class="p">,</span>
  <span class="n">plnphi</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii_Z_dnj</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p class="sd-card-text">Также зададим максимальное число итераций <span class="math notranslate nohighlight">\(N_{iter}\)</span>, точность решения системы нелинейных уравнений <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">maxiter</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># Maximum number of iterations</span>
<span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="c1"># Tolerance</span>
</pre></div>
</div>
<p class="sd-card-text">Создадим функцию, которая будет принимать на вход кортеж из результатов предыдущей итерации, точность и максимальное число итераций, и возвращать необходимость расчета следующей итерации цикла локальной минимизации функции энергии Гиббса. Проиницилизируем данную функцию.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">condit_newton</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">maxiter</span><span class="p">):</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">lnkvi</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">gi</span> <span class="o">=</span> <span class="n">carry</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="n">maxiter</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">gi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span>

<span class="n">pcondit_newton</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">condit_newton</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">)</span>
</pre></div>
</div>
<p class="sd-card-text">Найдем положение локального минимума функции энергии Гиббса с использованием метода Ньютона.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kvi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stabres</span><span class="o">.</span><span class="n">kvji</span><span class="p">):</span>
    <span class="n">lnkvi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kvi</span><span class="p">)</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="n">solve2p_FGH</span><span class="p">(</span><span class="n">kvi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
    <span class="n">F2</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span>
    <span class="n">y2i</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1</span> <span class="o">*</span> <span class="p">(</span><span class="n">kvi</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">y1i</span> <span class="o">=</span> <span class="n">y2i</span> <span class="o">*</span> <span class="n">kvi</span>
    <span class="n">lnphi2i</span><span class="p">,</span> <span class="n">Z2</span><span class="p">,</span> <span class="n">dlnphi2idn2j</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii_Z_dnj</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y2i</span><span class="p">,</span> <span class="n">F2</span><span class="p">)</span>
    <span class="n">lnphi1i</span><span class="p">,</span> <span class="n">Z1</span><span class="p">,</span> <span class="n">dlnphi1idn1j</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">getPT_lnphii_Z_dnj</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y1i</span><span class="p">,</span> <span class="n">F1</span><span class="p">)</span>
    <span class="n">gi</span> <span class="o">=</span> <span class="n">lnkvi</span> <span class="o">+</span> <span class="n">lnphi1i</span> <span class="o">-</span> <span class="n">lnphi2i</span>
    <span class="n">U</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diagflat</span><span class="p">(</span><span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">y1i</span> <span class="o">*</span> <span class="n">y2i</span><span class="p">))</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1</span> <span class="o">*</span> <span class="n">F2</span><span class="p">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">dlnphi1idn1j</span> <span class="o">+</span> <span class="n">dlnphi2idn2j</span> <span class="o">+</span> <span class="n">U</span>
    <span class="n">carry</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lnkvi</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">gi</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">pcondit_newton</span><span class="p">(</span><span class="n">carry</span><span class="p">):</span>
        <span class="n">carry</span> <span class="o">=</span> <span class="n">pupdate_newton_2p</span><span class="p">(</span><span class="n">carry</span><span class="p">)</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">lnkvi</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">gi</span> <span class="o">=</span> <span class="n">carry</span>
    <span class="n">gnorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">gi</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gnorm</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>
        <span class="n">kvi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lnkvi</span><span class="p">)</span>
        <span class="n">y2i</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">/</span> <span class="p">(</span><span class="n">F1</span> <span class="o">*</span> <span class="p">(</span><span class="n">kvi</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">y1i</span> <span class="o">=</span> <span class="n">y2i</span> <span class="o">*</span> <span class="n">kvi</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For the initial guess #</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">tolerance of equations: </span><span class="si">{</span><span class="n">gnorm</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">number of iterations: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">phase compositions:</span><span class="se">\n\t\t</span><span class="si">{</span><span class="n">y1i</span><span class="si">}</span><span class="se">\n\t\t</span><span class="si">{</span><span class="n">y2i</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">phase mole fractions: </span><span class="si">{</span><span class="n">F1</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="mf">1.</span><span class="o">-</span><span class="n">F1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">break</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>For the initial guess #0:<br>	tolerance of equations: 4.269762269031524e-07<br>	number of iterations: 5<br>	phase compositions:<br>		[0.58460017 0.09334225 0.11409613 0.06614494 0.14181651]<br>		[0.72640669 0.08921767 0.09005433 0.04323157 0.05108973]<br>	phase mole fractions: 0.06845024732091974, 0.9315497526790802
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Метод Ньютона нашел состояние, характеризующееся равенством летучестей соответствующих компонентов в фазах, всего за пять итераций. Проверим, является ли это состояние стабильным. Для этого проведем тест стабильности для одной из фаз:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stabres</span> <span class="o">=</span> <span class="n">stab</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">y2i</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stabres</span><span class="p">)</span>
</pre></div>
</div>
<div class="output text_html">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre id="codecell20" tabindex="0"><span></span>The one-phase state is stable:<br>True<br>Tangent-plane distance:<br>-1e-08
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell20">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
</div><p class="sd-card-text">Тест стабильности показал, что найденное решение соответствует равновесному состоянию.</p>
</div>
</details><p>В данном примере начальные приближения для метода локальной минимизации функции энергии Гиббса были получены на основе результатов теста стабильности. Пример реализации алгоритма определения равновесного состояния системы, основанного на применении метода последовательных подстановок для уточнения начальных приближений, представлен <a class="reference external" href="https://github.com/DanielSkorov/ReservoirSimulation/blob/main/_src/flash.py">здесь</a>.</p>
<p>Таким образом, в рамках данного подраздела были подробно рассмотрены различные алгоритмы расчета равновесного состояния для известных давления, температуры и компонентного состава, а также их реализации. Следующий подраздел будет посвящен нахождению равновесного состояния для известных объема, температуры и компонентного состава.</p>
</section>
</section>
</section>
<section id="vt">
<span id="pvt-esc-equilibrium-vt"></span><h2>VT-термодинамика<a class="headerlink" href="#vt" title="Link to this heading">#</a></h2>
<!-- TODO: Показать, как учитывать условие электронейтральности при расчете равновесного состояния. -->
<!-- TODO: Показать пример расчета равновесного состояния с учетом распределения ионов в полярных фазах. -->
<p>Стоит отметить, что в данном разделе основное внимание уделялось алгоритмам нахождения равновесного состояния для различных условий. Однако оптимизация времени, затрачиваемого на работу того или иного алгоритма, зависит не только от самого алгоритма, но и от его реализации: работы с памятью, распараллеливания, векторизации вычислений. Подробнее это было рассмотрено авторами работы [<a class="reference external" href="https://doi.org/10.2118/163583-MS">Haugen and Beckner, 2013</a>].</p>
<p>Данный раздел, был посвящен нахождению равновесного состояния для различных формулировок. В следующих разделах будут рассмотрены алгоритмы нахождения предельных состояний, характерных для многокомпонентных систем. В том числе речь пойдет про поиск линий насыщения, конденсации, а также про определение критического состояния системы, являющегося пределом фазового равновесия.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./1-PVT\3-SEC"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="SEC-4-RR-NP.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Уравнение Речфорда-Райса для многофазных систем</p>
      </div>
    </a>
    <a class="right-next"
       href="SEC-6-Saturation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Определение насыщенного состояния системы</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pt">PT-термодинамика</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-ss">Метод последовательных подстановок</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-ss-init">Начальные приближения</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-ss-examples">Примеры</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-newton">Метод минимизации функции</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-newton-init">Начальные приближения</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pvt-sec-equilibrium-pt-newton-examples">Примеры</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#vt">VT-термодинамика</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Daniel Skorov
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022 – 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>