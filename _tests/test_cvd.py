import sys

sys.path.append('../_src/')

import logging

logger = logging.getLogger('lab')
logger.setLevel(logging.INFO)
handler = logging.StreamHandler(sys.stdout)
formatter = logging.Formatter('%(message)s')
handler.setFormatter(formatter)
logger.addHandler(handler)

import unittest

import numpy as np

np.set_printoptions(linewidth=np.inf)

from eos import (
  pr78,
)

from lab import (
  cvdPT,
  SimpleSeparator,
  GasSeparator,
)


class cvd(unittest.TestCase):

  def test_01(self):
    PP = np.array([12240., 10720., 9180., 7640., 6120., 4650., 3110., 1680.,
                   100.]) * 1e3
    T = 13.8 + 273.15
    yi = np.array([0.078407, 0.862017, 0.033332, 0.013233, 0.006012, 0.004636,
                   0.001919, 0.000432, 1.2e-5])
    Pci = np.array([32.789, 45.4, 48.2, 41.9, 37.022, 33.008, 20.794, 16.727,
                    11.698]) * 101325.
    Tci = np.array([122.141, 190.6, 305.4, 369.8, 419.746, 482.781, 547.033,
                    674.011, 833.580])
    wi = np.array([0.02946, 0.008, 0.098, 0.152, 0.18767, 0.25456, 0.31931,
                   0.32841, 0.43005])
    vsi = np.array([-0.15670, -0.18633, -0.15018, -0.11403, -0.07789,
                    -0.02655, 0.01541, 0.10440, 0.22653])
    mwi = np.array([27.385, 16.043, 30.070, 44.097, 58.124, 77.671, 103.418,
                    185.177, 298.021]) / 1e3
    dij = np.array([
      0.00030,
      0.00035, 0.00566,
      0.00043, 0.01884, 0.00296,
      0.00121, 0.02884, 0.00874, 0.00087,
      0.00150, 0.04275, 0.01812, 0.00824, 0.00211,
      0.00176, 0.06061, 0.03113, 0.02758, 0.01329, 0.00564,
      0.00418, 0.15956, 0.10787, 0.07426, 0.04277, 0.02351, -0.00126,
      0.00630, 0.19705, 0.13549, 0.08406, 0.05104, 0.02627, -0.01284,-0.01087,
    ])
    pr = pr78(Pci, Tci, wi, mwi, vsi, dij)
    sepg = SimpleSeparator(pr)
    sepo = SimpleSeparator(pr)
    cvd = cvdPT(pr, sepg, sepo)
    res = cvd.run(PP, T, yi, 20e6)
    pass

  def test_02(self):
    PP = np.array([12240., 10720., 9180., 7640., 6120., 4650., 3110., 1680.,
                   100.]) * 1e3
    T = 13.8 + 273.15
    yi = np.array([0.078407, 0.862017, 0.033332, 0.013233, 0.006012, 0.004636,
                   0.001919, 0.000432, 1.2e-5])
    Pci = np.array([32.789, 45.4, 48.2, 41.9, 37.022, 33.008, 20.794, 16.727,
                    11.698]) * 101325.
    Tci = np.array([122.141, 190.6, 305.4, 369.8, 419.746, 482.781, 547.033,
                    674.011, 833.580])
    wi = np.array([0.02946, 0.008, 0.098, 0.152, 0.18767, 0.25456, 0.31931,
                   0.32841, 0.43005])
    vsi = np.array([-0.15670, -0.18633, -0.15018, -0.11403, -0.07789,
                    -0.02655, 0.01541, 0.10440, 0.22653])
    mwi = np.array([27.385, 16.043, 30.070, 44.097, 58.124, 77.671, 103.418,
                    185.177, 298.021]) / 1e3
    dij = np.array([
      0.00030,
      0.00035, 0.00566,
      0.00043, 0.01884, 0.00296,
      0.00121, 0.02884, 0.00874, 0.00087,
      0.00150, 0.04275, 0.01812, 0.00824, 0.00211,
      0.00176, 0.06061, 0.03113, 0.02758, 0.01329, 0.00564,
      0.00418, 0.15956, 0.10787, 0.07426, 0.04277, 0.02351, -0.00126,
      0.00630, 0.19705, 0.13549, 0.08406, 0.05104, 0.02627, -0.01284,-0.01087,
    ])
    pr = pr78(Pci, Tci, wi, mwi, vsi, dij)
    sepg = GasSeparator(pr)
    sepo = SimpleSeparator(pr)
    cvd = cvdPT(pr, sepg, sepo)
    res = cvd.run(PP, T, yi, 20e6)
    pass

  def test_03(self):
    PP = np.array([17120., 16360., 15820., 14940., 13850., 12670., 11490.,
                   10180., 9220., 7180., 5590., 3210., 1590., 910., 350.,
                   101.]) * 1e3
    T = 68. + 273.15
    yi = np.array([0.7167, 0.0895, 0.0917, 0.0448, 0.0573])
    Pci = np.array([45.99, 48.72, 42.48, 37.96, 23.975]) * 1e5
    Tci = np.array([190.56, 305.32, 369.83, 425.12, 551.022])
    mwi = np.array([16.043, 30.07, 44.097, 58.123, 120.0]) / 1e3
    wi = np.array([0.012, 0.1, 0.152, 0.2, 0.414])
    vsi = np.array([-0.1017, -0.0766, -0.0499, -0.0219, 0.0909])
    dij = np.array([
      0.0027,
      0.0085, 0.0017,
      0.0147, 0.0049, 0.0009,
      0.0393, 0.0219, 0.0117, 0.0062,
    ])
    pr = pr78(Pci, Tci, wi, mwi, vsi, dij)
    sepg = SimpleSeparator(pr)
    sepo = SimpleSeparator(pr)
    cvd = cvdPT(pr, sepg, sepo)
    res = cvd.run(PP, T, yi, 17e6)
    pass

  def test_04(self):
    PP = np.array([34575.1, 27680.4, 20785.6, 14580.3, 8375.1, 4927.7]) * 1e3
    T = 124.44 + 273.15
    yi = np.array([0.0001, 0.0011, 0.6963, 0.0863, 0.0534, 0.0115, 0.0233,
                   0.0093, 0.0085, 0.0173, 0.046808865, 0.021179837,
                   0.013661825, 0.008213373, 0.0030361])
    Pci = np.array([72.8, 33.5, 45.4, 48.2, 41.9, 36.0, 37.5, 33.4, 33.3,
                    32.46, 29.1862, 23.274195, 19.855981, 17.096682,
                    16.23444]) * 101325.
    Tci = np.array([304.2, 126.2, 190.6, 305.4, 369.8, 408.1, 425.2, 460.4,
                    469.6, 507.5, 558.96444, 629.35895, 678.01295, 723.01566,
                    893.91147])
    wi = np.array([0.225, 0.040, 0.008, 0.098, 0.152, 0.176, 0.193, 0.227,
                   0.251, 0.27504, 0.31228, 0.43337435, 0.53091175,
                   0.63045267, 1.0341])
    mwi = np.array([44.010, 28.013, 16.043, 30.070, 44.097, 58.124, 58.124,
                    72.151, 72.151, 86.000, 110.46812, 149.37189, 183.83825,
                    221.96509, 310.37874]) / 1e3
    vsi = np.array([-0.09434672, -0.12838834, -0.2038605, -0.10210346,
                    -0.07330094, -0.05706875, -0.05705589, -0.03446267,
                    -0.03446267, -0.004992, 0.091683057, 0.12673869,
                    0.1509548, 0.17233488, 0.089525733])
    dij = np.array([
     -0.0200,
      0.1030, 0.0310,
      0.1300, 0.0420, 0.0027,
      0.1350, 0.0910, 0.0085, 0.0017,
      0.1300, 0.0950, 0.0127, 0.0055, 0.0011,
      0.1300, 0.0950, 0.0147, 0.0049, 0.0019, 0.0001,
      0.1250, 0.0950, 0.0179, 0.0067, 0.0028, 0.0002, 0.0003,
      0.1250, 0.0950, 0.0206, 0.0086, 0.0037, 0.0004, 0.0005, 0.0001,
      0.1500, 0.1200, 0.0253, 0.0117, 0.0046, 0.0012, 0.0015, 0.0002, 0.0002,
      0.1500, 0.1200, 0.0321, 0.0166, 0.0078, 0.0031, 0.0035, 0.0012, 0.0013,
      0.0004,
      0.1500, 0.1200, 0.0471, 0.0280, 0.0163, 0.0090, 0.0097, 0.0057, 0.0058,
      0.0036, 0.0016,
      0.1500, 0.1200, 0.0580, 0.0368, 0.0232, 0.0143, 0.0153, 0.0101, 0.0102,
      0.0073, 0.0042, 0.0006,
      0.1500, 0.1200, 0.0667, 0.0440, 0.0291, 0.0191, 0.0202, 0.0142, 0.0144,
      0.0108, 0.0070, 0.0020, 0.0004,
      0.1500, 0.1200, 0.0856, 0.0601, 0.0427, 0.0305, 0.0319, 0.0243, 0.0245,
      0.0199, 0.0146, 0.0067, 0.0032, 0.0014,
    ])
    pr = pr78(Pci, Tci, wi, mwi, vsi, dij)
    sepg = SimpleSeparator(pr)
    sepo = SimpleSeparator(pr)
    cvd = cvdPT(pr, sepg, sepo)
    res = cvd.run(PP, T, yi, 35e6)
    pass

if __name__ == '__main__':
  unittest.main(verbosity=0)
